var isMobileMoe=!1;(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|ipad|iris|kindle|Android|Silk|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(navigator.userAgent)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(navigator.userAgent.substr(0,4)))&&(isMobileMoe=!0),function(a){"use strict";function b(){}function c(a,b){if(e)return b.indexOf(a);for(var c=b.length;c--;)if(b[c]===a)return c;return-1}var d=b.prototype,e=!!Array.prototype.indexOf;d._getEvents=function(){return this._events||(this._events={})},d.getListeners=function(a){var b,c,d=this._getEvents();if("object"==typeof a){b={};for(c in d)d.hasOwnProperty(c)&&a.test(c)&&(b[c]=d[c])}else b=d[a]||(d[a]=[]);return b},d.getListenersAsObject=function(a){var b,c=this.getListeners(a);return c instanceof Array&&(b={},b[a]=c),b||c},d.addListener=function(a,b){var d,e=this.getListenersAsObject(a);for(d in e)e.hasOwnProperty(d)&&-1===c(b,e[d])&&e[d].push(b);return this},d.on=d.addListener,d.defineEvent=function(a){return this.getListeners(a),this},d.defineEvents=function(a){for(var b=0;b<a.length;b+=1)this.defineEvent(a[b]);return this},d.removeListener=function(a,b){var d,e,f=this.getListenersAsObject(a);for(e in f)f.hasOwnProperty(e)&&-1!==(d=c(b,f[e]))&&f[e].splice(d,1);return this},d.off=d.removeListener,d.addListeners=function(a,b){return this.manipulateListeners(!1,a,b)},d.removeListeners=function(a,b){return this.manipulateListeners(!0,a,b)},d.manipulateListeners=function(a,b,c){var d,e,f=a?this.removeListener:this.addListener,g=a?this.removeListeners:this.addListeners;if("object"!=typeof b||b instanceof RegExp)for(d=c.length;d--;)f.call(this,b,c[d]);else for(d in b)b.hasOwnProperty(d)&&(e=b[d])&&("function"==typeof e?f.call(this,d,e):g.call(this,d,e));return this},d.removeEvent=function(a){var b,c=typeof a,d=this._getEvents();if("string"===c)delete d[a];else if("object"===c)for(b in d)d.hasOwnProperty(b)&&a.test(b)&&delete d[b];else delete this._events;return this},d.emitEvent=function(a,b){var c,d,e=this.getListenersAsObject(a);for(d in e)if(e.hasOwnProperty(d))for(c=e[d].length;c--;)!0===(b?e[d][c].apply(null,b):e[d][c]())&&this.removeListener(a,e[d][c]);return this},d.trigger=d.emitEvent,d.emit=function(a){var b=Array.prototype.slice.call(arguments,1);return this.emitEvent(a,b)},"function"==typeof define&&define.amd?define(function(){return b}):a.EventEmitter=b,a.EventEmitter||(a.EventEmitter=b)}(this),function(a){function b(a){var b=h();return"object"==typeof a&&a.type?l[a.type]?l[a.type].push(b):(l[a.type]=[],l[a.type].push(b)):l[a]?l[a].push(b):(l[a]=[],l[a].push(b)),i.p.then(function(){document.getElementById(f)?document.getElementById(f).contentWindow.postMessage(a,g):console.log("IFRAME IS MISSING - Please include the iframe when doing an HTTP integration. For docs, click here http://docs.moengage.com/docs/http-integration .")}),b.p}function c(a,b){m[a]=b}function d(a){a.origin||a.originalEvent.origin;if(a.data&&a.data.type){if(l[a.data.type]){for(var b=0;b<l[a.data.type].length;)l[a.data.type][b].res(a.data),b++;delete l[a.data.type]}m[a.data.type]&&m[a.data.type](a)}}function e(c,d){f=c,g=d,a.webio.sendMessage=b}if("undefined"==typeof Promise)console.log("Promises not supported!");else{var f,g,h=function(){var a,b;return{p:new Promise(function(c,d){a=c,b=d}),res:a,rej:b}},i=h(),j=function(a){function b(b,e){for(var g=0;g<f.length;){if(a[b]==f[g]){e?(f.splice(g,1),0==f.length&&c()):d();break}g++}}var c,d,e=new Promise(function(a,b){c=a,d=b});if("object"!=typeof a&&!a.length)return void console.log("all - Expects array with atleast one element as input!");for(var f=[],g=0;g<a.length;)f.push(a[g]),function(c){a[c].then(function(){b(c,!0)},function(){b(c,!1)})}(g),g++;return e},k=function(a){var b,c,d=new Promise(function(a,d){b=a,c=d});return setTimeout(function(){b()},a),d},l={},m={},n=function(a,b){a&&b?e(a,b):console.log("webio USAGE-  webio.sendMessageInit(<frame-id>,<iframe-url>)")};a.webio={factory:h,sendMessageInit:n,onMessage:c,all:j,timeout:k,onload:i},a.addEventListener("message",d,!1)}}(window),function(a){a.MoengageAssist=function(){webio.onload.p.then(function(){a.MoengageAssistDisable=function(){var a=document.getElementById("moengage-assist");a.parentNode.removeChild(a)},a.moengageAssistToggle=function(){try{var a=document.getElementById("moengage-assist");"50%"==a.style.left?a.style.left="100%":a.style.left="50%"}catch(a){console.log("MOENGAGE-ASSIST-EXCEPTION",a)}},a.moengageAssistPerformIntegrationChecks=function(){try{var a=JSON.parse(localStorage.getItem("moeWebSDKSettings"));if(a){var b=document.getElementById("moengage_assist_serviceworker_present"),c=document.getElementById("moengage_assist_manifest_present"),d=document.getElementById("moengage_assist_manifest_sender_id_check"),e=document.getElementById("moengage_assist_manifest_included_in_head");if("HTTP"==a.webData.domain_type.toUpperCase()){var f=a.webData.subdomainUrl;"/"!=f[f.length-1]&&(f=f.substring(0,f.lastIndexOf("/")+1));var g=a.webData.serviceworker_file||"serviceworker.js";webio.sendMessage({type:"moengage_assist_integration_checks"}).then(function(h){h.token.serviceworker_present?(b.style.color="rgba(30, 113, 105, 1)",b.innerHTML="✓ Serviceworker is present."):(b.style.color="rgba(162, 63, 60, 1)",b.innerHTML="❌ Serviceworker is not present here - "+f+g),h.token.manifest_present?(c.style.color="rgba(30, 113, 105, 1)",c.innerHTML="✓ Manifest is present."):(c.style.color="rgba(162, 63, 60, 1)",c.innerHTML="❌ Manifest is not present here - "+f+"manifest.json"),h.token.manifest_sender_id&&h.token.manifest_sender_id==a.webData.project_number?(d.style.color="rgba(30, 113, 105, 1)",d.innerHTML="✓ Contents of manifest verified with the database."):(d.style.color="rgba(162, 63, 60, 1)",d.innerHTML="❌ Contents of manifest not consistent with the database."),h.token.manifest_included_in_head?(e.style.color="rgba(30, 113, 105, 1)",e.innerHTML="✓ Manifest included in the &lt;head&gt;."):(e.style.color="rgba(162, 63, 60, 1)",e.innerHTML="❌ Manifest not included in the &lt;head&gt; at root ( / ).")})}else if("HTTPS"==a.webData.domain_type.toUpperCase()){var g=a.webData.serviceworker_file||"serviceworker.js",h=window.location.origin;"/"!=h[h.length-1]&&(h+="/"),fetch(h+g).then(function(a){200!=a.status?(b.style.color="rgba(162, 63, 60, 1)",b.innerHTML="❌ Serviceworker is not present here - "+h+g):(b.style.color="rgba(30, 113, 105, 1)",b.innerHTML="✓ Serviceworker is present.")});var i=h+"manifest.json";fetch(i).then(function(b){200!=b.status?(c.style.color="rgba(162, 63, 60, 1)",c.innerHTML="❌ Manifest is not present here - "+i):(c.style.color="rgba(30, 113, 105, 1)",c.innerHTML="✓ Manifest is present.",b.json().then(function(b){b&&b.gcm_sender_id==a.webData.project_number?(d.style.color="rgba(30, 113, 105, 1)",d.innerHTML="✓ Contents of manifest verified with the database."):(d.style.color="rgba(162, 63, 60, 1)",d.innerHTML="❌ Contents of manifest not consistent with the database.")}))});var j=!1,k=document.head.getElementsByTagName("link");Array.prototype.forEach.call(k,function(a){a.href==i&&(j=!0)}),j?(e.style.color="rgba(30, 113, 105, 1)",e.innerHTML="✓ Manifest included in the &lt;head&gt;."):(e.style.color="rgba(162, 63, 60, 1)",e.innerHTML="❌ Manifest not included in the &lt;head&gt; at root ( / ).")}}}catch(a){console.log("MOENGAGE-ASSIST-EXCEPTION",a)}},a.moengageAssistSettingsRefetch=function(){localStorage.removeItem("moeWebSDKSettings"),localStorage.removeItem("moeWebSDKSettingsSetupTime"),window.location.reload()},a.moengageAssistClearLastPrompt=function(){localStorage.removeItem("MOE_LAST_PROMPT"),localStorage.removeItem("SOFT_LOAD"),window.location.reload()},a.moengageAssistSelectText=function(a){try{if(document.selection){var b=document.body.createTextRange();b.moveToElementText(document.getElementById(a)),b.select()}else if(window.getSelection){var b=document.createRange();b.selectNode(document.getElementById(a)),window.getSelection().removeAllRanges(),window.getSelection().addRange(b)}}catch(a){console.log("MOENGAGE-ASSIST-EXCEPTION",a)}},a.moengageAssistAgoCalculator=function(a){try{if(a){var b=parseInt(a),c=new Date;c=c.getTime();var d=(c-b)/1e3/3600;return d<1?(d*=60,Math.round(d)+" minute(s) ago"):Math.round(d)+" hour(s) ago"}}catch(a){console.log("MOENGAGE-ASSIST-EXCEPTION",a)}},a.moengageAssistStartOver=function(){try{var b=JSON.parse(localStorage.getItem("moeWebSDKSettings"));localStorage.getItem("moeWebSDKSettingsSetupTime");if(b){var c=webio.factory();"HTTP"==b.webData.domain_type.toUpperCase()?(httpsDomain=b.webData.subdomainUrl,webio.sendMessage("is_already_accepted").then(function(a){c.res(a.token.toUpperCase())})):"HTTPS"==b.webData.domain_type.toUpperCase()&&(httpsDomain=window.location.origin,c.res(Notification.permission.toUpperCase())),c.p.then(function(b){"PROMPT"==b||"DEFAULT"==b?(a.moengageAssistToggle(),setTimeout(function(){window.location.reload()},2e3),Moengage.destroy_session()):(document.getElementById("moengage_assist_migrated_user").style.display="block",document.getElementById("moengage_assist_migrated_user").innerHTML="Reset Notification permission(to Ask By Default) on "+httpsDomain+" and click on this button again.",setTimeout(function(){document.getElementById("moengage_assist_migrated_user").style.display="none"},5e3))})}}catch(a){console.log("MOENGAGE-ASSIST-EXCEPTION",a)}},a.moengageAssistRefresh=function(){try{var a=JSON.parse(localStorage.getItem("moeWebSDKSettings")),b=localStorage.getItem("moeWebSDKSettingsSetupTime");if(a){var c="",d=webio.factory();document.getElementById("moengage_assist_domain_type").innerHTML=a.webData.domain_type.toUpperCase(),"HTTP"==a.webData.domain_type.toUpperCase()?(document.getElementById("moengage_assist_subdomain_div").style.display="block",document.getElementById("moengage_assist_subdomain").innerHTML=a.webData.subdomainUrl,c=a.webData.subdomainUrl,webio.sendMessage("is_already_accepted").then(function(a){document.getElementById("moengage_assist_page_permission").innerHTML=a.token.toUpperCase(),d.res(a.token.toUpperCase())})):"HTTPS"==a.webData.domain_type.toUpperCase()&&(c=window.location.origin,document.getElementById("moengage_assist_page_permission").innerHTML=Notification.permission.toUpperCase(),d.res(Notification.permission.toUpperCase())),d.p.then(function(b){if("PROMPT"==b||"DEFAULT"==b)if(document.getElementById("moengage_assist_self_invoke_optin_message").style.display="none",localStorage.getItem("MOE_LAST_PROMPT")||localStorage.getItem("SOFT_LOAD")){document.getElementById("moengage_assist_last_prompt_div").style.display="block";var d=localStorage.getItem("SOFT_LOAD")||localStorage.getItem("MOE_LAST_PROMPT");document.getElementById("moengage_assist_last_prompt").innerHTML=moengageAssistAgoCalculator(d),a.webData.promptAgain=a.webData.promptAgain||24,document.getElementById("moengage_assist_prompt_again").innerHTML=a.webData.promptAgain+" hour(s)"}else a.webData.call_push_moengage||(document.getElementById("moengage_assist_self_invoke_optin").style.display="block");else document.getElementById("moengage_assist_self_invoke_optin").style.display="none","GRANTED"!=b&&(document.getElementById("moengage_assist_self_invoke_optin_message").style.display="block",document.getElementById("moengage_assist_self_invoke_optin_message").innerHTML="Reset Notification permission(to Ask By Default) on "+c+" to opt in."),document.getElementById("moengage_assist_last_prompt_div").style.display="none"}),a.webData.PushSubBilling?document.getElementById("moengage_assist_billing_plan").innerHTML="SUBSCRIBER BASED BILLING":document.getElementById("moengage_assist_billing_plan").innerHTML="NORMAL BILLING"}document.getElementById("moengage_assist_settings_last_fetched").innerHTML=moengageAssistAgoCalculator(b);var e=JSON.parse(localStorage.getItem("moengage_data"));e&&e.uuid&&(document.getElementById("moengage_assist_device_uid").innerHTML=e.uuid);var f=localStorage.getItem("MOE_PUSH_TOKEN");f&&(document.getElementById("moengage_assist_device_push_token").innerHTML=f),setTimeout(moengageAssistRefresh,5e3)}catch(a){console.log("MOENGAGE-ASSIST-EXCEPTION",a)}};var b=document.createElement("div");b.style.height="100%",b.style.paddingLeft="10px",b.style.width="50%",b.style.position="fixed",b.style.top="0px",b.style.zIndex="999999999999",b.style.background="rgba(0,0,0,0.85)",b.style.left="100%",b.style.color="#ffffff",b.style.fontFamily="sans-serif",b.style.transition="left ease 1s",b.id="moengage-assist",document.getElementById("moengage-assist")||(document.body.appendChild(b),document.getElementById("moengage-assist").innerHTML="<style>.moengage-assist-loader{display:inline-block;border: 3px solid #f3f3f3;border-top: 3px solid rgba(51, 171, 160, 0.9);border-radius: 50%;width: 15px;height: 15px;animation: moengageassistspin 2s linear infinite;}#moengage-assist hr{border: 0;clear:both;display:block;width: 96%;background-color:#454545;height: 1px;}@keyframes moengageassistspin {0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); }}.moengage-assist-btn{padding:7px;background:rgba(51, 171, 160, 0.9);border-radius:2px;cursor:pointer;}.moengage-assist-widget{line-height:25px;float:left;width:50%;-webkit-box-sizing: border-box;-moz-box-sizing: border-box;box-sizing: border-box;padding: 10px;color:#efefef;}@media only screen and (max-width: 768px) {.moengage-assist-widget{line-height:25px;float:left;width:100%;-webkit-box-sizing: border-box;-moz-box-sizing: border-box;box-sizing: border-box;padding: 10px;color:#efefef;}}</style><div id='moengage-assist-toggle' onclick='moengageAssistToggle()' style='position: absolute;background: rgba(51, 171, 160, 0.9);left: -140px;width:140px;top: 30%;font-size:14px;padding: 10px 2px 10px 10px;border-radius: 5px 0px 0px 5px;border: 4px solid rgba(255,255,255,0.1);display: inline-block;cursor: pointer;vertical-align: middle;text-align: center;-webkit-box-sizing: border-box;-moz-box-sizing: border-box;box-sizing: border-box;'>MoEngage Assist</div><div style='width:100%;height:100%;overflow-y:scroll;overflow-x:hidden;'><div style='text-align: center;background: rgba(0,0,0,0.9);'><img src='https://cdn.moengage.com/images/logo-light.png'/></div><hr/><div class='moengage-assist-widget' style='width:100%;text-align:center;padding:10px;border-radius:2px;background:rgba(255,255,255,0.6);color:#333333;'><span style='font-weight:bold;'>INTEGRATION CHECKS</span><br><span style='font-weight:bold;float:left' id='moengage_assist_serviceworker_present'><div class='moengage-assist-loader'></div> Checking if serviceworker is present...</span><br><span style='font-weight:bold;float:left' id='moengage_assist_manifest_present'><div class='moengage-assist-loader'></div> Checking if manifest.json is present...</span><br><span style='font-weight:bold;float:left' id='moengage_assist_manifest_sender_id_check'><div class='moengage-assist-loader'></div> Verifying gcm_sender_id in manifest.json...</span><br><span style='font-weight:bold;float:left' id='moengage_assist_manifest_included_in_head'><div class='moengage-assist-loader'></div> Checking if manifest is included in &lt;head&gt;...</span><br></div><hr/><div class='moengage-assist-widget'><span>DOMAIN TYPE :  </span><span style='font-weight:bold;color:#efefef;' id='moengage_assist_domain_type'>-</span><div id='moengage_assist_subdomain_div' style='display:none;'><span>HTTPS URL :  </span><span style='font-weight:bold;color:#efefef;' id='moengage_assist_subdomain'>-</span></div></div><div class='moengage-assist-widget'><span>SETTINGS LAST FETCHED :  </span><span style='font-weight:bold;color:#efefef;' id='moengage_assist_settings_last_fetched'>-</span>&nbsp;<div style='text-align:center;'><span onclick='moengageAssistSettingsRefetch()' class='moengage-assist-btn'>FETCH NOW</span></div></div><hr/><div class='moengage-assist-widget' onclick='moengageAssistSelectText(\"moengage_assist_device_uid\")'><span>DEVICE UID :  </span><span style='font-weight:bold;color:#444444;background:rgba(255,255,255,0.8);' id='moengage_assist_device_uid'>---</span><br><div style='text-align:center;'><span>(Click to select)</span></div></div><div class='moengage-assist-widget' onclick='moengageAssistSelectText(\"moengage_assist_device_push_token\")'><span>PUSH TOKEN :  </span><span style='font-weight:bold;color:#444444;background:rgba(255,255,255,0.8);' id='moengage_assist_device_push_token'>---</span><br><div style='text-align:center;'><span>(Click to select)</span></div></div><hr/><div class='moengage-assist-widget' ><span>OPT-IN-STATE :  </span><span style='font-weight:bold;color:#efefef;' id='moengage_assist_page_permission'>---</span><br><div style='text-align:center;display:none;' id='moengage_assist_self_invoke_optin'><span onclick='Moengage.call_web_push()' class='moengage-assist-btn'>SELF INVOKE OPT-IN</span></div><br><span style='display:none;background:rgba(217, 83, 79, 0.8);padding:5px;border-radius:5px;' id='moengage_assist_self_invoke_optin_message'></span></div><div class='moengage-assist-widget' ><span>BILLING :  </span><span style='font-weight:bold;color:#efefef;' id='moengage_assist_billing_plan'>---</span></div><div class='moengage-assist-widget' id='moengage_assist_last_prompt_div' style='display:none;width:100%;background:rgba(217, 83, 79, 0.8);'><span>OPT-IN-LAST-DISMISSED :  </span><span style='font-weight:bold;color:#efefef;' id='moengage_assist_last_prompt'>---</span>&nbsp;<span class='moengage-assist-btn' onclick='moengageAssistClearLastPrompt()'>RESET</span><br><span>*** OPT-IN will be displayed again </span><span id='moengage_assist_prompt_again'></span><span> after the last opt-in-dismiss.</span></div><div class='moengage-assist-widget' style='text-align:center;width:100%;'><span class='moengage-assist-btn' style='background:rgba(217, 83, 79, 0.8);' onclick='moengageAssistStartOver()'>START OVER</span></div><div class='moengage-assist-widget' id='moengage_assist_migrated_user' style='border-radius:5px;display:none;width:100%;background:rgba(217, 83, 79, 0.8);color:#efefef;'></div></div>"),setTimeout(a.moengageAssistToggle,2e3),a.moengageAssistRefresh(),setTimeout(a.moengageAssistPerformIntegrationChecks,5e3)},function(a){console.log("MOENGAGE-ASSIST-EXCEPTION",a)})}}(window);var FEATURE_LIST={WEB_PUSH:"web_push",TRACKING:"tracking"},moeLoadingComplete=!1,moeSubscribeUserSwap,moeUnSubscribeUserSwap,moeCheckPushSubscriptionStatus,moeLoadBanner,moeRemoveBanner,moeOpenPopup,moeIsOpenedOnce,moeCloseBanner,moeHttpsFlag,moeDomainLevelStorageFlag,webSdkIntegration=!1,moePermissionStateVal,moelocalStorageWrapper,moeEvents=new EventEmitter,moeBannerText="banner",moe=function(a){function b(){return{getItem:function(a){if(moeDomainLevelStorageFlag){var b=l(a),c=localStorage.getItem(a);c!=b&&""!=b&&('"'==b[0]&&"{"==b[1]&&(b=JSON.parse(b)),b!=c&&localStorage.setItem(a,b))}return localStorage.getItem(a)},setItem:function(a,b){if(moeDomainLevelStorageFlag){try{b=b.replace(";","")}catch(a){}k(a,b)}return localStorage.setItem(a,b)},removeItem:function(a){return moeDomainLevelStorageFlag&&m(a),localStorage.removeItem(a)}}}function c(){return Y||(Y=webio.factory()),X||(X=new Promise(function(a,b){"undefined"!=typeof Storage?"device_add"in M&&1==M.device_add?(J&&console.log("device already added, not adding again"),K=1,a()):sa().then(function(b){Ia(I+"/v2/device/add",b,post_data={},function(b,c){if(b=""==b?{}:JSON.parse(b),200==c){J&&console.log("Device Added!"),K=1,M.device_add=!0,oa(M,!0).then(a);var d=new CustomEvent("DEVICE_ADD_CALL_INTERNAL",{detail:{result:"success"}});window.dispatchEvent(d)}else{var d=new CustomEvent("DEVICE_ADD_CALL_INTERNAL",{detail:{result:"fail"}});window.dispatchEvent(d),J&&console.log("Device not added -- Server Error!"),a()}})}):(J&&console.log("Sorry, your browser does not support Web Storage..."),b())}).then(function(){Y.res()})),X}function e(){return"localhost"===window.location.hostname?"http":"https:"===window.location.protocol?"https":"http"}function f(){ea.then(function(){ta().then(function(a){a.webData.ws&&1==a.webData.ws&&ya()})}).catch(function(a){console.log("WS-CONNECT --",a)})}function g(a){0!==a.errorCode&&(J&&console.log("onConnectionLost:"+a.errorMessage),j())}function h(a){j()}function j(){J&&console.log("disconnected, trying after "+E.backOffTime),E.backOffTime<=32&&(E.backOffTime=2*E.backOffTime,setTimeout(function(){connectionOptions={userName:H.userName,password:H.password},connectionOptions.onSuccess=va,connectionOptions.onFailure=h,E.connect(connectionOptions)},1e3*E.backOffTime))}function k(a,b){var c=window.location.origin;c=c.indexOf(".")!=c.lastIndexOf(".")?c.substring(c.indexOf(".")):"."+c.substring(c.lastIndexOf("/")+1),document.cookie=a.toString()+"="+b.toString()+";domain="+c+";path=/;"}function l(a){for(var b=a+"=",c=decodeURIComponent(document.cookie),d=c.split(";"),e=0;e<d.length;e++){for(var f=d[e];" "==f.charAt(0);)f=f.substring(1);if(0==f.indexOf(b))return f.substring(b.length,f.length)}return""}function m(a){document.cookie=a+"=;expires=Thu, 01 Jan 1970 00:00:01 GMT;"}function n(a){if("http"==a.webData.domain_type&&"Google Chrome"==G&&F.getItem("MOE_PUSH_TOKEN")&&"NA"!=F.getItem("MOE_PUSH_TOKEN")&&"granted"==W&&a.webData.webPushPlatformData&&a.webData.webPushPlatformData.chrome&&a.webData.webPushPlatformData.chrome.api_key){var b={e:"MOE_TOKEN_EXPIRED",l:M.uuid};o(a).then(function(a){if(a){var c=(new Date).getTime();c-(F.getItem("moe_token_expired")||0)>60*24*60*1e3&&(La(b),F.setItem("moe_token_expired",c)),p()}})}}function o(a){return new Promise(function(b,c){var d=new Headers({Authorization:"key="+a.webData.webPushPlatformData.chrome.api_key});fetch("https://iid.googleapis.com/iid/info/"+F.getItem("MOE_PUSH_TOKEN")+"?details=true",{headers:d}).then(function(a){b(200!=a.status?!0:!1)})})}function p(){ta().then(function(a){"http"==a.webData.domain_type&&webio.sendMessage({type:"moengage_remove_expired_token"}).then(function(a){F.removeItem("MOE_PUSH_TOKEN"),F.removeItem("MOE_PUSH_ENDPOINT")})})}function q(){f(),da.res(),"undefined"!=typeof Storage?ta().then(function(a){return n(a),new Promise(function(a,b){ca?(J&&console.log("Device added - Normal billing!"),ua().then(a),ha.p.then(function(a){"granted"==a||1==M.device_add&&"granted"==M.user_attr["Web Push Preference"]&&M.user_attr["Web Push Preference"]!=a&&ua().then(function(){Na("Web Push Preference",a),Ma("MOE_WEB_UNSUBSCRIBED",{Source:"Website"}),moeEvents.emitEvent("permission",[a])})})):ha.p.then(function(b){"granted"==b?(ua().then(a),J&&console.log("Device added - Push/email Subscribed billing!")):1==M.device_add&&"granted"==M.user_attr["Web Push Preference"]&&M.user_attr["Web Push Preference"]!=b&&ua().then(function(){a(),webio.all([Na("Web Push Preference",b),Ma("MOE_WEB_UNSUBSCRIBED",{Source:"Website"})]).then(function(){moeEvents.emitEvent("permission",[b]),ra()||(M.device_add=!1,oa(M,!0),X=null)})}),ra()?ua().then(a):ra()||"granted"==b||1!=M.device_add?a():(M.device_add=!1,oa(M,!0),X=null,a())})})}).then(function(){Ma("EVENT_ACTION_WEB_SESSION_START",{timestamp:Number(Date.now()),URL:location.href}),Ma("MOE_PAGE_VIEWED",{timestamp:Number(Date.now()),URL:location.href}),J&&console.log("User structure: ",M),moeEvents.emitEvent("moeEvents",["loadingComplete"]),moeLoadingComplete=!0,setInterval(function(){na()},retry_time)}):J&&console.log("%cSorry, your browser does not support Web Storage...","color:red; font-size:20px")}function r(a,b){this.lat=a,this.long=b,this.type="MoeLocation"}function s(a){settingsData=a.webData.banner,moeLoadBanner=function(){"ACCEPT"!=F.getItem("MOE_ACCEPTED")&&"DENY"!=F.getItem("MOE_ACCEPTED")?D(a)&&moeLoadBannerInternal():"ACCEPT"==F.getItem("MOE_ACCEPTED")&&"http"==a.webData.domain_type&&a.webData.call_push_moengage&&a.webData.banner&&a.webData.banner.banner_flag&&(!F.getItem("MOE_PUSH_TOKEN")||"NA"==F.getItem("MOE_PUSH_TOKEN")||"null"==F.getItem("MOE_PUSH_TOKEN"))&&D(a)&&moeLoadBannerInternal(!1,!0)},moeLoadOldBanner=function(){var a="top:50%;display:inline-table;transform: translateY(-50%);position:relative;cursor:pointer;",b="color:"+settingsData.opt_in_text_color,c="text-decoration:"+settingsData.opt_in_text_style,d="font-size:"+settingsData.opt_in_text_font_size+"px",e=a+b+";"+c+";"+d+";",f='style="'+e;if(1==moeHttpsFlag)var g="moeBannerText",h='<span onclick="moeSubscribeUserSwap('+g+')"'+f+'">';else var g="moeBannerText",h='<span onclick="moeIsOpenedOnce('+g+')"'+f+'">';var i="top:50%;display:inline-table;transform: translateY(-50%);position:relative;margin-left:10px;cursor:pointer;",j="color:"+settingsData.close_text_color,k="text-decoration:"+settingsData.close_text_style,l="font-size:"+settingsData.close_text_font_size+"px",m=i+j+";"+k+";"+l+";",n='style="'+m,o='<span onclick="moeRemoveBanner()"'+n+'">',p=h+settingsData.opt_in_text+"</span>",q=o+settingsData.close_text+"</span>",r='style="top:50%;display:inline-table;transform: translateY(-50%);position:absolute;right:5px;font-size: 12px;padding: 5px;cursor:pointer;'+j+';"',s='<span onclick="moeRemoveBanner()"'+r+'">X</span>',t=p+q+s;document.getElementById("moe-push-div").innerHTML=t;var u=document.querySelector("#moe-push-div");u.style.backgroundColor=settingsData.banner_bg_color,u.style.color=settingsData.banner_txt_color,u.style.height=settingsData.banner_height+"px",u.style.zIndex="9999",u.style.top="0px",u.style.width="100%",u.style.position="relative",u.style.textAlign="center",u.style.fontFamily="'"+settingsData.banner_txt_font+"'"},moeLoadBannerInternal=function(a,b){var c=document.createElement("div");c.id="moe-push-div",c.className="moe-push-class";var d=document.body.firstChild;d.parentNode.insertBefore(c,d),ta().then(function(c){if(showOldBanner=!0,null!=c.webData.bannerHtml&&("mweb"==la&&null!=c.webData.bannerHtml.mweb&&(document.getElementById("moe-push-div").innerHTML=c.webData.bannerHtml.mweb,showOldBanner=!1),"web"==la&&null!=c.webData.bannerHtml.web&&(document.getElementById("moe-push-div").innerHTML=c.webData.bannerHtml.web,showOldBanner=!1)),1==a){if(document.getElementById("moe-push-div").onclick=function(){hideOneClickTransparentOverlay()},"Google Chrome"==G||"Opera Neon"==G){for(var d=document.getElementsByClassName("moe_chrome"),e=d.length-1;e>=0;e--)d[e].style.display="block";0==d.length&&(document.getElementById("moe-push-div").style.display="none")}else if("Mozilla Firefox"==G){for(var d=document.getElementsByClassName("moe_firefox"),e=d.length-1;e>=0;e--)d[e].style.display="block";0==d.length&&(document.getElementById("moe-push-div").style.display="none")}else if("Opera"==G){for(var d=document.getElementsByClassName("moe_opera"),e=d.length-1;e>=0;e--)d[e].style.display="block";0==d.length&&(document.getElementById("moe-push-div").style.display="none")}else if("Apple Safari"==G){for(var d=document.getElementsByClassName("moe_safari"),e=d.length-1;e>=0;e--)d[e].style.display="block";0==d.length&&(document.getElementById("moe-push-div").style.display="none")}return!0}if(showOldBanner)moeLoadOldBanner();else{Ma("MOE_WEB_OPTIN_BANNER_LOAD",{});var f=new CustomEvent("MOE_OPT_IN",{detail:"soft_ask_shown"});window.dispatchEvent(f);var g="banner";"https"==c.webData.domain_type&&document.getElementById("optInText")?document.getElementById("optInText").onclick=function(){moeSubscribeUserSwap(g)}:c.webData.conventional&&1==c.webData.conventional&&document.getElementById("optInText")?document.getElementById("optInText").onclick=function(){y()}:"http"==c.webData.domain_type&&document.getElementById("optInText")?document.getElementById("optInText").onclick=1==b?function(){moeCloseBanner(),moeOpenPopup(),t()}:function(){moeIsOpenedOnce(g)}:"http"==c.webData.domain_type&&document.getElementById("optInTextConventional")?document.getElementById("optInTextConventional").onclick=function(){y()}:"http"==c.webData.domain_type&&document.getElementById("optInTextConventionalWindow")&&(document.getElementById("optInTextConventionalWindow").onclick=function(){z()})}})},hideOneClickTransparentOverlay=function(){if(document.getElementById("moe-push-div")){document.getElementById("moe-push-div").style.display="none",document.getElementById("moe-push-div").style.opacity="0";var a=document.getElementById("moe-push-div");a.parentNode.removeChild(a)}else J&&console.log("moe-push-div MISSING")},moeRemoveBanner=function(){var a=new CustomEvent("MOE_OPT_IN",{detail:"soft_ask_closed"});window.dispatchEvent(a),Ma("MOE_WEB_OPTIN_CLOSED",{}),F.setItem("SOFT_LOAD",Date.now());var b=document.getElementById("moe-push-div");b.parentNode.removeChild(b)},moeCloseBanner=function(){var a=document.getElementById("moe-push-div");a&&a.parentNode.removeChild(a)}}function t(){webio.sendMessage("get_push_token").then(function(a){a&&a.token&&"null"!=a.token&&!F.getItem("MOE_PUSH_TOKEN")?(a&&a.endpoint&&F.setItem("MOE_PUSH_ENDPOINT",a.endpoint),F.setItem("MOE_PUSH_TOKEN",a.token),fa.res(),J&&console.log("PUSH TOKEN UPDATED!!"),ua().then(function(){moeEvents.emitEvent("permission",["granted"]),Na("Web Push Preference","granted"),Na("Web Subscription URL",window.location.href),Ma("MOE_USER_SUBSCRIBED",{MOE_WEB_PUSH_TOKEN:a.token,URL:window.location.href}),Ma("MOE_USER_SUBSCRIBED",{MOE_WEB_PUSH_TOKEN:a.token,URL:window.location.href},"calldeviceadd")})):a&&a.token&&F.getItem("MOE_PUSH_TOKEN")!=a.token&&"null"!=a.token&&(a&&a.endpoint&&F.setItem("MOE_PUSH_ENDPOINT",a.endpoint),F.setItem("MOE_PUSH_TOKEN",a.token),fa.res(),J&&console.log("PUSH TOKEN UPDATED!!"),ua().then(function(){moeEvents.emitEvent("permission",["granted"]),Na("Web Push Preference","granted"),Ma("MOE_USER_SUBSCRIPTION_CHECK",{MOE_WEB_PUSH_TOKEN:a.token,URL:window.location.href}),Ma("MOE_USER_SUBSCRIPTION_CHECK",{MOE_WEB_PUSH_TOKEN:a.token,URL:window.location.href},"calldeviceadd")})),!a||null!=a.token&&"null"!=a.token?fa.res():(db<=2&&(db+=.5),setTimeout(function(){t()},1e3*db))})}function u(a){ha.p.then(function(a){"prompt"==a&&(ta().then(function(a){0==a.webData.banner.banner_flag&&moeLoadBannerInternal(!0)}),moeEvents.on("permission",function(a){hideOneClickTransparentOverlay()}))}),webio.sendMessage("ask_for_notification").then(function(b){moeEvents.emitEvent("permission",["changed"]),b.token&&"ACCEPT"==b.token?(ha.p.then(function(b){if("prompt"==b){var c=new CustomEvent("MOE_OPT_IN",{detail:"opt_in_allowed"})
;window.dispatchEvent(c),Ma("MOE_OPT_IN_ALLOWED",{}),a&&a.hard_ask_allow_callback&&a.hard_ask_allow_callback()}}),F.setItem("ask_web_push",!1),t(),F.getItem("MOE_PUSH_TOKEN")&&"null"!=F.getItem("MOE_PUSH_TOKEN")&&"NA"!=F.getItem("MOE_PUSH_TOKEN")||cb||A(),F.setItem("MOE_ACCEPTED","ACCEPT"),moeEvents.emitEvent("permission",["granted"])):b.token&&"PROMPT"==b.token?(ha.p.then(function(b){if("prompt"==b){var c=new CustomEvent("MOE_OPT_IN",{detail:"opt_in_dismissed"});window.dispatchEvent(c),Ma("MOE_OPT_IN_DISMISSED",{}),a&&a.hard_ask_dismiss_callback&&a.hard_ask_dismiss_callback()}}),F.setItem("MOE_ACCEPTED","PROMPT"),F.setItem("MOE_PUSH_TOKEN","NA"),moeEvents.emitEvent("permission",["clicked_close"]),F.setItem("MOE_LAST_PROMPT",Date.now()),ia&&(moeEvents.emitEvent("permission",["prompt"]),Na("Web Push Preference","prompt")),ra()||ca||(M.device_add=!1,oa(M,!0),X=null)):b.token&&"DENY"==b.token&&(ha.p.then(function(b){if("prompt"==b){var c=new CustomEvent("MOE_OPT_IN",{detail:"opt_in_blocked"});window.dispatchEvent(c),Ma("MOE_OPT_IN_BLOCKED",{}),Ma("Web Push Opt-in Denied",{}),a&&a.hard_ask_block_callback&&a.hard_ask_block_callback()}}),F.setItem("MOE_ACCEPTED","DENY"),F.setItem("MOE_PUSH_TOKEN","NA"),F.setItem("ask_web_push",!1),ia&&(moeEvents.emitEvent("permission",["denied"]),Na("Web Push Preference","denied")),ra()||ca||(M.device_add=!1,oa(M,!0),X=null))})}function v(){return webio.sendMessage("moengage_data_from_frame")}function w(a){sa().then(function(b){var c=a,d={type:"moengage_data_to_frame",token:c,collect_data:b};webio.sendMessage(d)})}function x(a,b,c,d){var e=screen.width/2-c/2,f=screen.height/2-d/1.2;return window.open(a,b,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+c+", height="+d+", top="+f+", left="+e)}function y(){var a=new CustomEvent("MOE_OPT_IN",{detail:"soft_ask_allowed"});window.dispatchEvent(a),Ma("MOE_WEB_OPTIN_ACCEPTED",{}),moeCloseBanner(),window.open(Ba+"?conventional=1&")}function z(){var a=new CustomEvent("MOE_OPT_IN",{detail:"soft_ask_allowed"});window.dispatchEvent(a),Ma("MOE_WEB_OPTIN_ACCEPTED",{}),moeCloseBanner(),x(Ba+"?conventional=1&","mywin",550,450)}function A(){F.getItem("MOE_HTTP_OVERLAY")||F.setItem("MOE_HTTP_OVERLAY",0),parseInt(F.getItem("MOE_HTTP_OVERLAY"))<2&&(document.getElementById("moe_overlay")?(ba||(document.getElementById("moe_overlay").style.display="block",document.getElementById("moe_overlay").style.opacity="1"),F.setItem("MOE_HTTP_OVERLAY",parseInt(F.getItem("MOE_HTTP_OVERLAY"))+1),Ma("MOE_HTTP_OVERLAY_SHOWN",{REPEAT:ba})):J&&console.log("MOENGAGE_OVERLAY MISSING"))}function B(a,b){function c(a){var b=document.createDocumentFragment(),c=document.createElement("div");for(c.innerHTML=a;c.firstChild;)b.appendChild(c.firstChild);return b}var d;d=b?a.webData.overlayHtmlSubscribed||'<div id="moe_overlay" onclick="moeOpenPopup()" style="display: none; transition: opacity 1s ease-out; opacity: 0;position: fixed;top: 0px;left: 0px;width: 100%;height: 100%;background: rgba(0, 0, 0, 0.6);z-index: 9999999;color: #34495e;font-family: Trebuchet, Arial, sans-serif"><style>.moebtn,.moebtn>*{position:relative}.moebtn,.moebtn span,.moebtn:before{display:block}.moebtn{margin:30px auto;padding:0;overflow:hidden;border-width:0;outline:0;border-radius:2px;box-shadow:0 1px 4px rgba(0,0,0,.6);background-color:#2ecc71;color:#ecf0f1;transition:background-color .3s}.moebtn:focus,.moebtn:hover{background-color:#27ae60}.moe_content,.moebtn:before{position:absolute;top:50%;left:50%}.moebtn span{padding:12px 24px}.moebtn:before{content:"";width:0;padding-top:0;border-radius:100%;background-color:rgba(236,240,241,.3);-webkit-transform:translate(-50%,-50%);-moz-transform:translate(-50%,-50%);-ms-transform:translate(-50%,-50%);-o-transform:translate(-50%,-50%);transform:translate(-50%,-50%)}.moebtn:active:before{width:120%;padding-top:120%;transition:width .5s ease-out,padding-top .5s ease-out}.moebtn.moeorange{background-color:#e67e22}.moebtn.moeorange:focus,.moebtn.moeorange:hover{background-color:#d35400}.moe_content{width:25%;transform:translate(-50%,-50%);background:rgba(255,255,255,.95);border-radius:10px 10px 0px 0px;text-align:center;display:inline-block}@media only screen and (max-width:800px){.moe_content{background:#fff;border-radius:10px 10px 0px 0px;display:inline-block;left:50%;position:absolute;text-align:center;top:50%;transform:translate(-EUNITNO50%,-50%);width:85%}}</style><div id="moe_container" style="text-align: center;display: table-cell;vertical-align: middle;"><div class="moe_content"><center><img src="https://cdn.moengage.com/images/check.gif" height="100px" width="100px" style="width:100px;height:100px;"><h2 style="padding:5px;font-weight: 400;font-size:25px;">You are subscribed!</h2><button type="button" class="moebtn moeorange"><span>Close</span></button></center><div style="text-align: right !important;position: absolute !important;    right: 0px !important;border-radius:0px 0px 10px 10px;width:100%;background:rgba(0,0,0,0.7);float:right;"><a href="#" target="_blank" style="text-decoration: none !important;cursor: pointer !important;color:#A5A0A0 !important;font-size: 11px !important;display:inline;" onclick="window.open(\'https://moengage.com/web-push/?utm_source=moengage_branding&utm_medium=webpush\',\'_blank\');event.cancelBubble = true; if (event.stopPropagation) event.stopPropagation();return false;"> Powered by <img src="https://cdn.moengage.com/images/logo-light.png" style="max-width: 100% !important; height: 35px !important;vertical-align: middle !important; padding-right: 3px !important;margin-bottom:auto;display:inline;width:75px;"></a></div></div></div></div>':a.webData.overlayHtml||'<div id="moe_overlay" onclick="moeOpenPopup()" style="display: none; transition: opacity 1s ease-out; opacity: 0;position: fixed;top: 0px;left: 0px;width: 100%;height: 100%;background: rgba(0, 0, 0, 0.6);z-index: 9999999;color: #34495e;font-family: Trebuchet, Arial, sans-serif"><style>.moebtn,.moebtn>*{position:relative}.moebtn,.moebtn span,.moebtn:before{display:block}.moebtn{margin:30px auto;padding:0;overflow:hidden;border-width:0;outline:0;border-radius:2px;box-shadow:0 1px 4px rgba(0,0,0,.6);background-color:#2ecc71;color:#ecf0f1;transition:background-color .3s}.moebtn:focus,.moebtn:hover{background-color:#27ae60}.moe_content,.moebtn:before{position:absolute;top:50%;left:50%}.moebtn span{padding:12px 24px}.moebtn:before{content:"";width:0;padding-top:0;border-radius:100%;background-color:rgba(236,240,241,.3);-webkit-transform:translate(-50%,-50%);-moz-transform:translate(-50%,-50%);-ms-transform:translate(-50%,-50%);-o-transform:translate(-50%,-50%);transform:translate(-50%,-50%)}.moebtn:active:before{width:120%;padding-top:120%;transition:width .5s ease-out,padding-top .5s ease-out}.moebtn.moeorange{background-color:#e67e22}.moebtn.moeorange:focus,.moebtn.moeorange:hover{background-color:#d35400}.moe_content{width:25%;transform:translate(-50%,-50%);background:rgba(255,255,255,.95);border-radius:10px 10px 0px 0px;text-align:center;display:inline-block}@media only screen and (max-width:800px){.moe_content{background:#fff;border-radius:10px 10px 0px 0px;display:inline-block;left:50%;position:absolute;text-align:center;top:50%;transform:translate(-EUNITNO50%,-50%);width:85%}}</style><div id="moe_container" style="text-align: center;display: table-cell;vertical-align: middle;"><div class="moe_content"><center><img src="https://cdn.moengage.com/images/check.gif" height="100px" width="100px" style="width:100px;height:100px;"><h2 style="padding:5px;font-weight: 400;font-size:25px;">Thank you for subscribing!</h2><button type="button" class="moebtn moeorange"><span>Close</span></button></center><div style="text-align: right !important;position: absolute !important;    right: 0px !important;border-radius:0px 0px 10px 10px;width:100%;background:rgba(0,0,0,0.7);float:right;"><a href="#" target="_blank" style="text-decoration: none !important;cursor: pointer !important;color:#A5A0A0 !important;font-size: 11px !important;display:inline;" onclick="window.open(\'https://moengage.com/web-push/?utm_source=moengage_branding&utm_medium=webpush\',\'_blank\');event.cancelBubble = true; if (event.stopPropagation) event.stopPropagation();return false;"> Powered by <img src="https://cdn.moengage.com/images/logo-light.png" style="max-width: 100% !important; height: 35px !important;vertical-align: middle !important; padding-right: 3px !important;margin-bottom:auto;display:inline;width:75px;"></a></div></div></div></div>';var e=c(d);document.body.insertBefore(e,document.body.childNodes[0])}function C(a){try{"serviceWorker"in navigator?ta().then(function(b){var c="/";if(b.webData.is_service_worker_not_root){var d=window.location.pathname;c=d.substring(0,d.lastIndexOf("/")+1)}"/"===c&&"/"!==a[0]&&(a="/"+a),V=navigator.serviceWorker.register(a,{scope:c}),P(window.moe_data_internal,"forceSwUpdate",!1)&&V.then(function(a){a.update()})}):console.log("Servie Worker Not Supported")}catch(a){J&&console.log("Serviceworker registration Failed!",a)}}function D(a){var b=Number(F.getItem("SOFT_LOAD"))||Number(F.getItem("MOE_LAST_PROMPT"))||0,c=Math.abs(Date.now()-b),d=Math.ceil(c/36e5);J&&console.log("Last prompt showed "+d+" hours ago.");var e=23;return"promptAgain"in a.webData&&(e=a.webData.promptAgain),d>e}var E,F,G,H={userName:"moewriteonly",password:"moe"},I="https://websdk.moengage.com",J=0,K=0,L="5.0",M={user_attr:{},event_queue:[],user_attr_queue:[],device_add:!1},N=function(a){for(var b="=".repeat((4-a.length%4)%4),c=(a+b).replace(/\-/g,"+").replace(/_/g,"/"),d=atob(c),e=new Uint8Array(d.length),f=0;f<d.length;++f)e[f]=d.charCodeAt(f);return e},O=function(a){for(var b,c,d,e,f,g="",h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=new Uint8Array(a),j=i.byteLength,k=j%3,l=j-k,m=0;m<l;m+=3)f=i[m]<<16|i[m+1]<<8|i[m+2],b=(16515072&f)>>18,c=(258048&f)>>12,d=(4032&f)>>6,e=63&f,g+=h[b]+h[c]+h[d]+h[e];return 1==k?(f=i[l],b=(252&f)>>2,c=(3&f)<<4,g+=h[b]+h[c]+"=="):2==k&&(f=i[l]<<8|i[l+1],b=(64512&f)>>10,c=(1008&f)>>4,d=(15&f)<<2,g+=h[b]+h[c]+h[d]+"="),g},P=function(a,b,c){return Array.isArray||(Array.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)}),b=Array.isArray(b)?b:b.split("."),a=a[b[0]],a&&b.length>1?P(a,b.slice(1),c):void 0===a?c:a},Q=function(){function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return J&&console.log("Generating new unique_id"),a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()},R=function(){},S={track_event:R,add_user_attribute:R,add_first_name:R,add_last_name:R,add_email:R,add_mobile:R,add_user_name:R,add_gender:R,add_birthday:R,destroy_session:R,add_unique_user_id:R,moe_events:R,location_type_attribute:R,call_web_push:R,test_cases:R},T=navigator.userAgent;if(-1!=navigator.userAgent.indexOf("MSIE")||1==!!document.documentMode)return G="Internet Explorer",console.log("Browser not supported."),function(){return S};if(T.indexOf("Edge")>-1?G="Edge":T.indexOf("OPR")>-1||T.indexOf("Opera")>-1?G="Opera":T.indexOf("Chrome")>-1?(G="Google Chrome",T.indexOf("MMS")>-1&&(G="Opera Neon")):G=T.indexOf("Safari")>-1?"Apple Safari":T.indexOf("Firefox")>-1?"Mozilla Firefox":"Others","undefined"==typeof Notification||!Notification)return function(){return S};var U,V,W,X,Y,Z=0,$=0,_=0,aa=5,ba=!1,ca=!0,da=webio.factory(),ea=webio.onload.p,fa=webio.factory(),ga=webio.factory(),ha=webio.factory(),ia=!1,ja=!1;ea.then(function(){var a=new Event("moengage_loaded");window.dispatchEvent(a);try{if(window.moengage_q&&window.moengage_q.length>0&&window.moengage_object){for(key in window.moengage_q)window[window.moengage_object][window.moengage_q[key].f].apply(null,window.moengage_q[key].a);window.moengage_q=[]}}catch(a){J&&console.log(a)}});var ka,la="web";0==isMobileMoe?la="web":1==isMobileMoe&&(la="mweb"),ka=navigator.userAgent;var ma,na=function(){_>aa||(_+=1,(M.event_queue.length<Z||M.user_attr_queue.length<$)&&(_=0),"event_queue"in M&&0!=M.event_queue.length&&sa().then(function(a){post_data=M.event_queue.pop(),Ia(I+"/v2/report/add",a,post_data,function(a,b){a=""==a?{}:JSON.parse(a),200==b?J&&console.log("Report Sent!"):(J&&console.log("Not sent queued!"),M.event_queue.push(post_data)),oa(M)})}),"user_attr_queue"in M&&0!=M.user_attr_queue.length&&sa().then(function(a){post_data=M.user_attr_queue.pop(),Ia(I+"/v2/report/add",a,post_data,function(a,b){a=""==a?{}:JSON.parse(a),200==b?J&&console.log("Report Sent!"):(J&&console.log("Not sent queued!"),M.user_attr_queue.push(post_data)),oa(M)})}),Z=M.event_queue.length,$=M.user_attr_queue.length)},oa=function(a,b){return new Promise(function(c,d){try{F.setItem("moengage_data",JSON.stringify(a)),!b||moeHttpsFlag||webSdkIntegration||w(a),c()}catch(a){J&&console.log("Cannot set Item",a),d()}})},pa=["USER_ATTRIBUTE_USER_EMAIL"],qa=function(a){return pa.indexOf(a)>-1},ra=function(){for(i in pa)if(pa[i]in M.user_attr&&""!=M.user_attr[pa[i]]&&"null"!=M.user_attr[pa[i]]&&"undefined"!=M.user_attr[pa[i]])return!0;return!1},sa=function(){var a=new Date,b=Date.UTC(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate(),a.getUTCHours(),a.getUTCMinutes(),a.getUTCSeconds(),a.getUTCMilliseconds());return promise=new Promise(function(a){ab().then(function(c){if(get_params={os:la,os_platform:ka,is_incognito:c,app_id:window.moe_data_internal.app_id,os_ver:G,sdk_ver:L,model:G,app_ver:1,device_ts:Number(b),device_tz_offset:-6e4*(new Date).getTimezoneOffset(),unique_id:M.uuid,device_tz:(new Date).getTimezoneOffset()},1==moeHttpsFlag){var d=F.getItem("MOE_PUSH_TOKEN");get_params.push_id=d&&"null"!=d?d:"NA"}else if(1!=moeHttpsFlag){var d=F.getItem("MOE_PUSH_TOKEN");get_params.push_id=d&&"null"!=d?d:"NA"}var e=F.getItem("MOE_PUSH_ENDPOINT");if(e){e=JSON.parse(e);for(var f in e)e.hasOwnProperty(f)&&(get_params[f]=encodeURI(e[f]))}"NA"==get_params.push_id&&(get_params.push_id=""),"environment"in window.moe_data_internal&&""!=window.moe_data_internal.environment&&(get_params.environment=window.moe_data_internal.environment),ta().then(function(b){get_params.sender_id=P(b,"webData.webPushPlatformData.chrome.project_number",null),get_params.subscription_type="normal","Google Chrome"===G||"Opera"===G||"Opera Neon"===G?"vapid"===P(b,"webData.webPushPlatformData.chrome.subscriptionMode","normal")&&null!=P(b,"webData.webPushPlatformData.chrome.vapidPublicKey",null)&&(get_params.vapid_public=b.webData.webPushPlatformData.chrome.vapidPublicKey,get_params.subscription_type="vapid"):"Mozilla Firefox"===G&&"vapid"===P(b,"webData.webPushPlatformData.firefox.subscriptionMode","normal")&&null!=P(b,"webData.webPushPlatformData.firefox.vapidPublicKey",null)&&(get_params.vapid_public=b.webData.webPushPlatformData.firefox.vapidPublicKey,get_params.subscription_type="vapid"),b.webData.serviceworker_file&&(get_params.serviceworker_file=b.webData.serviceworker_file),a(get_params)})})}),promise},ta=function(){return ma||(ma=new Promise(function(a){var b=(new Date).getTime(),c=localStorage.getItem("moeWebSDKSettingsSetupTime"),d=localStorage.getItem("ask_web_push");if(null==c||J)Ha(I+"/websdksettings",{app_id:window.moe_data_internal.app_id},function(c){if("string"==typeof c&&(c=JSON.parse(c)),"multi"===c.webData.domain_type){ja=!0;var d=e();c.webData.domain_type=d,"https"===d?null!=c.webData.banner?c.webData.banner.banner_flag=!1:c.webData.banner={banner_flag:!1}:null!=c.webData.banner?c.webData.banner.banner_flag=!0:c.webData.banner={banner_flag:!0}}c.webData&&void 0!=c.webData.call_push_moengage||(c.webData.call_push_moengage=!0,c.webData.banner={banner_flag:!1},J&&console.log("%c Please save Notification Opt-In Configuration in app.moengage.com","background: #222; color: #bada55"));var f=JSON.stringify(c);localStorage.setItem("moeWebSDKSettingsSetupTime",b),localStorage.setItem("moeWebSDKSettings",f),a(c)});else if(b-c>864e5){if(Ha(I+"/websdksettings",{app_id:window.moe_data_internal.app_id},function(c){"string"==typeof c&&(c=JSON.parse(c)),"multi"==c.webData.domain_type&&(ja=!0,c.webData.domain_type=e(),"https"===e()?null!=c.webData.banner?c.webData.banner.banner_flag=!1:c.webData.banner={banner_flag:!1}:null!=c.webData.banner?c.webData.banner.banner_flag=!0:c.webData.banner={banner_flag:!0}),c.webData&&void 0!=c.webData.call_push_moengage||(c.webData.call_push_moengage=!0,c.webData.banner={banner_flag:!1},J&&console.log("%c Please save Notification Opt-In Configuration in app.moengage.com","background: #222; color: #bada55"));var d=JSON.stringify(c);localStorage.setItem("moeWebSDKSettingsSetupTime",b),localStorage.setItem("moeWebSDKSettings",d),a(c)}),"false"==d)try{F.removeItem("ask_web_push")}catch(a){J&&console.log("Unable to update localstorage through localStorageWrapper")}}else{var f=JSON.parse(localStorage.getItem("moeWebSDKSettings"));a(f)}})),ma},ua=function(){return ha.p.then(function(a){return ta().then(function(b){return"granted"!=a||"Google Chrome"!=G&&"Mozilla Firefox"!=G&&"Opera"!=G&&"Opera Neon"!=G||ca?ca&&"granted"==a&&1==b.webData.call_push_moengage&&"https"==b.webData.domain_type?fa.p.then(function(){return c()}):c():fa.p.then(function(){return c()})})})},va=function(){E.backOffTime=1,E.subscribe("p/"+M.uuid),message=new Paho.MQTT.Message(JSON.stringify({unique_id:M.uuid})),message.destinationName="conn/"+window.moe_data_internal.app_id,E.send(message)},wa=function(a){try{var b=new Notification(a.title,{body:a.body,icon:a.icon,requireInteraction:a.requireInteraction});b.onclick=function(){window.open(a.url,"_blank"),b.close()}}catch(a){}},xa=function(a){wa(JSON.parse(a.payloadString))},ya=function(){connectionOptions={userName:H.userName,password:H.password},connectionOptions.onSuccess=va,connectionOptions.onFailure=h,E=new Paho.MQTT.Client("52.207.253.219",1144,Q()),E.onMessageArrived=xa,E.onConnectionLost=g,E.backOffTime=1,willMessageJson={unique_id:M.uuid},willMessage=new Paho.MQTT.Message(JSON.stringify(willMessageJson)),willMessage.destinationName="disc/"+window.moe_data_internal.app_id,connectionOptions.willMessage=willMessage,E.connect(connectionOptions)},za=function(a){ea.then(function(){ta().then(function(b){b.webData.ws&&1==b.webData.ws&&(message=new Paho.MQTT.Message(JSON.stringify(a)),message.destinationName="r/",message.destinationName+=window.moe_data_internal.app_id,message.qos=1,E&&E.isConnected()&&E.send(message))})}).catch(function(a){console.log("WS-CONNECT --",a)})},Aa=function(){Ma("MOE_SUBSCRIPTION_TIMEOUT",{}),F.setItem("MOE_HTTP_OVERLAY",5)};webio.onMessage("subscription_timeout",Aa),webio.onMessage("MOE_NEVER_ASK",function(){Ma("MOE_SUBSCRIPTION_UNSUCCESSFUL",{}),F.setItem("MOE_HTTP_OVERLAY",5)}),webio.onMessage("MOE_OPT_IN_SHOWN",function(){var a=new CustomEvent("MOE_OPT_IN",{detail:"opt_in_shown"});window.dispatchEvent(a),Ma("MOE_OPT_IN_SHOWN",{})}),webio.onMessage("MOE_OPT_IN_DISMISSED",function(){var a=new CustomEvent("MOE_OPT_IN",{detail:"opt_in_dismissed"});window.dispatchEvent(a),Ma("MOE_OPT_IN_DISMISSED",{}),fb&&fb.hard_ask_dismiss_callback&&fb.hard_ask_dismiss_callback()}),webio.onMessage("MOE_OPT_IN_ALLOWED",function(){var a=new CustomEvent("MOE_OPT_IN",{detail:"opt_in_allowed"});window.dispatchEvent(a),Ma("MOE_OPT_IN_ALLOWED",{}),fb&&fb.hard_ask_allow_callback&&fb.hard_ask_allow_callback()}),webio.onMessage("MOE_OPT_IN_BLOCKED",function(){var a=new CustomEvent("MOE_OPT_IN",{detail:"opt_in_blocked"});window.dispatchEvent(a),Ma("MOE_OPT_IN_BLOCKED",{}),fb&&fb.hard_ask_block_callback&&fb.hard_ask_block_callback()}),webio.onMessage("MOE_CONVENTIONAL_OPT_IN",function(){t()});var Ba,Ca=function(){"complete"!=window.document.readyState?window.addEventListener("load",function(){webio.onload.res()}):webio.onload.res()},Da=function(a){if(ab().then(function(a){window.moe_data_internal.is_incognito=a}),"retry_limit"in window.moe_data_internal&&(aa=window.moe_data_internal.retry_limit),"debug_logs"in window.moe_data_internal&&(J=window.moe_data_internal.debug_logs),"cluster"in window.moe_data_internal&&"in"==window.moe_data_internal.cluster&&(window.moe_data_internal.environment="apiv2mumbai"),"cluster"in window.moe_data_internal&&"eu"==window.moe_data_internal.cluster&&(window.moe_data_internal.environment="apiv2eu"),"environment"in window.moe_data_internal&&""!=window.moe_data_internal.environment&&(I="https://"+window.moe_data_internal.environment+".moengage.com"),"retry_time"in window.moe_data_internal?retry_time=window.moe_data_internal.retry_time:retry_time=2e3,debug_mode_message="%cYou are in %cdebug mode for Moengage, %cIf you are seeing this in production, please remove the debug flag!",J&&1!=a&&null!=window.moe_data_internal.app_id&&window.moe_data_internal.app_id.length>=6){var c=window.moe_data_internal.app_id;"_DEBUG"!==c.substr(c.length-6)&&(c+="_DEBUG"),window.moe_data_internal.app_id=c}J&&console.log(debug_mode_message,"color: red; font-size:15px;","color: red; font-size:20px;","color: red; font-size:15px;"),J&&console.log("Browser detected: ",G),"undefined"!=typeof Storage?(V=void 0,ca=!1,da=webio.factory(),ea=webio.onload.p,fa=webio.factory(),ga=webio.factory(),ha=webio.factory(),ia=!1,W=void 0,X=void 0,Y=void 0,window.moe_data_internal.assist&&1==window.moe_data_internal.assist&&window.MoengageAssist(),F=b(),moelocalStorageWrapper=b(),ta().then(function(a){function b(){document.body?e.res():setTimeout(function(){b()},500)}if(ga.p.then(function(b){ha.res(b),Ea(a.webData,FEATURE_LIST.WEB_PUSH)&&(moeDomainLevelStorageFlag&&k("MOE_PERMISSION",b),"granted"!=b||F.getItem("MOE_ACCEPTED")||ja||Na("Web Migrated User","true"),"granted"==b?("ACCEPT"!=F.getItem("MOE_ACCEPTED")&&(ia=!0),F.setItem("MOE_ACCEPTED","ACCEPT")):"denied"==b?(F.getItem("MOE_PUSH_TOKEN")&&F.setItem("MOE_PUSH_TOKEN","NA"),"DENY"!=F.getItem("MOE_ACCEPTED")&&(ia=!0),F.setItem("MOE_ACCEPTED","DENY")):"prompt"==b&&(F.removeItem("ask_web_push"),F.getItem("MOE_PUSH_TOKEN")&&F.setItem("MOE_PUSH_TOKEN","NA"),"PROMPT"!=F.getItem("MOE_ACCEPTED")&&(ia=!0),F.setItem("MOE_ACCEPTED","PROMPT")),s(a),F.getItem("MOE_PUSH_TOKEN")&&"NA"!=F.getItem("MOE_PUSH_TOKEN")&&fa.res())}),"https"!=a.webData.domain_type&&!ja||1!=a.webData.domain_level_storage||(moeDomainLevelStorageFlag=!0),ca=!a.webData.PushSubBilling,da.p.then(function(){1==a.webData.call_push_moengage?eb():"https"==a.webData.domain_type&&"granted"==Notification.permission&&eb()}),Ba=a.webData.subdomainUrl||"https://abc.moengage.com/",Ea(a.webData,FEATURE_LIST.TRACKING))if("https"!=a.webData.domain_type&&"http"!=a.webData.domain_type||!Ea(a.webData,FEATURE_LIST.WEB_PUSH))moeHttpsFlag=!1,webSdkIntegration=!0,J&&console.log("No webpush settings detected, you should be able to send events to moengage, but will not be able to send push! \nIf you need push capabilities, Please configure settings on Moengage dashboard on http://app.moengage.com/v3/#/settings/4 ."),Ca(),Fa(),ga.res("");else if("https"==a.webData.domain_type){Ca(),moeHttpsFlag=!0;var c="serviceworker.js";a.webData.serviceworker_file&&(c=a.webData.serviceworker_file),C(c);var d=Notification.permission;d="default"==d?"prompt":d,W=d,moeDomainLevelStorageFlag&&l("MOE_PERMISSION")?ga.res(l("MOE_PERMISSION")):ga.res(d),Fa()}else{F.getItem("MOE_PUSH_TOKEN")&&"NA"!=F.getItem("MOE_PUSH_TOKEN")&&"null"!=F.getItem("MOE_PUSH_TOKEN")&&F.setItem("MOE_HTTP_OVERLAY",2);var e=webio.factory();b(),e.p.then(function(){var b="";ja&&(b="?moe_multi_protocol=1");var c=document.getElementById("moengage_iframe");if(c){var d=c.onload;c.onload=function(){d&&d instanceof Function&&d(),webio.onload.res()},setTimeout(function(){"complete"!=window.document.readyState?window.addEventListener("load",function(){webio.onload.res()}):webio.onload.res()},5e3)}else{var e=document.createElement("iframe");e.style.display="none",e.src=a.webData.subdomainUrl+b,e.id="moengage_iframe",e.onload=function(){webio.onload.res()},document.body.appendChild(e)}webio.sendMessageInit("moengage_iframe",Ba),webio.sendMessage("is_already_accepted").then(function(a){"granted"==a.token.state&&(ba=!0),W=a.token.state,v().then(function(b){var c=F.getItem("MOE_PUSH_TOKEN");b&&b.endpoint2&&F.setItem("MOE_PUSH_ENDPOINT",b.endpoint2),b.push&&"null"!=b.push&&c!=b.push&&F.setItem("MOE_PUSH_TOKEN",b.push),F.getItem("MOE_PUSH_TOKEN")&&"NA"!=F.getItem("MOE_PUSH_TOKEN")&&"null"!=F.getItem("MOE_PUSH_TOKEN")&&F.setItem("MOE_HTTP_OVERLAY",2);var d=JSON.parse(b.token);null!=d&&"uuid"in d?(M=d,J&&console.log("User Linked from your iframe: ",d.uuid),oa(M,!0).then(q)):Fa(),ga.res(a.token.state)})})})}else J&&console.log("Tracking disabled for current environment.")})):J&&console.log("%cSorry, your browser does not support Web Storage...","color:red; font-size:20px")},Ea=function(a,b){var c=["domains"],d=function(a,b){var d=a[b];if(c.indexOf(b)>=0){if("domains"===b){return!(d.values.indexOf(window.location.hostname)>=0!=("whitelist"===d.type))}return!0}return!0},e=P(a,"featureAvailabilityMatrix."+b,null);return null==e||d(e,"domains")},Fa=function(){var a=JSON.parse(F.getItem("moengage_data"));null!=a&&"uuid"in a?(M=a,J&&console.log("Existing user detected, unique_id: ",a.uuid),oa(M,!0).then(q)):(M.uuid=Q(),J&&console.log("No existing user found, New unique_id generated and saved, unique_id: ",M),oa(M,!0).then(q))},Ga=function(){if(!window.moe_data_internal)return J&&console.log("Please pass data with moe like this moe({app_id:'t1'})"),!1;if(!window.moe_data_internal.app_id)return J&&console.log("%cApp Id is missing!","color:red; font-size:20px"),!1;var a=window.location.toString();return a.indexOf("moe_multi_protocol")<0&&a.indexOf("conventional")<0&&Da(),!0},Ha=function(a,b,c){var d=new XMLHttpRequest;a=Ja(a,b),d.open("GET",a,!0),d.onreadystatechange=function(){4==d.readyState&&200==d.status&&c&&c(d.responseText)},d.send()},Ia=function(a,b,c,d){var e=new XMLHttpRequest;a=Ja(a,b),e.open("POST",a,!0),e.onreadystatechange=function(){4==e.readyState&&d&&d(e.responseText,e.status,c)},e.send(JSON.stringify(c))},Ja=function(a,b){a+="?";for(var c in b)a+=c+"="+b[c]+"&";return a},Ka=function(a,arguments){var b="track_event_internal"==a?Oa:Pa,c=arguments;return Y||(Y=webio.factory()),"add_user_attribute_internal"==a&&qa(arguments[0])&&""!=arguments[0]&&"null"!=arguments[0]&&"undefined"!=arguments[0]?b(c[0],c[1],c[2]).then(function(a){return a},function(a){return J&&console.log("Failed",a),"FAILED "+a}):Y.p.then(function(){return b(c[0],c[1],c[2]).then(function(a){return a},function(a){return J&&console.log("Failed",a),"FAILED "+a})})},La=function(a){var b="?";a.l=a.l||M.uuid,ta().then(function(c){if(c.webData.ga_tracking&&1==c.webData.ga_tracking||"MOE_TOKEN_EXPIRED"==a.e){var d="v=1&t=event&tid=UA-51898729-2&cid="+M.uuid+"&ec="+window.moe_data_internal.app_id+"&ea="+a.e;b+=d,fetch("https://www.google-analytics.com/collect"+b,{method:"POST",body:JSON.stringify({})}).then(function(b){200==b.status?J&&console.log("GA Tracked",a.e):J&&console.log("GA Track Error",a.e)}).catch(function(a){J&&console.log("GA API CONNECT ERROR")})}})},Ma=function(a,b,c){var arguments=[];return arguments.push(a),arguments.push(b),arguments.push(c),Ka("track_event_internal",arguments)},Na=function(a,b,c){var arguments=[];return arguments.push(a),arguments.push(b),arguments.push(c),Ka("add_user_attribute_internal",arguments)},Oa=function(a,b,c){return da.p.then(function(){return new Promise(function(d,e){if(1==M.device_add){if(b=void 0!==b?b:{},"string"!=typeof a||"object"!=typeof b||""==typeof a)return J&&console.log("Event attributes(key) needs to be string and (value) = json.\nThe type you gave for key is "+typeof a+" and for value is "+typeof b+'.\nHence event "'+String(a)+'" wont be added'),void e(a);if(""===a||void 0==a||null==a)return J&&console.log("Cannot add an event with blank event name"),void e(a);sa().then(function(e){date=new Date;var f={};for(var g in b)if(b.hasOwnProperty(g)&&null!=b[g]&&void 0!=b[g])if("function"==typeof b[g].getMonth){var h={};h[g]=Math.round(b[g].getTime()-6e4*b[g].getTimezoneOffset()),null==f.timestamp&&(f.timestamp=[]),f.timestamp.push(h),delete b[g]}else if(b[g]instanceof r&&"MoeLocation"===b[g].type){var h={};h[g]=b[g].getLatLongString(),null==f.location&&(f.location=[]),f.location.push(h),delete b[g]}b.URL=window.location.href,post_data={e:a,a:b},0===Object.keys(f).length&&f.constructor===Object||(post_data.c=f);var i=new CustomEvent("MOE_EVENT",{detail:post_data});if(window.dispatchEvent(i),0==K)return"event_queue"in M||(M.event_queue=[]),J&&console.log("not sent queued!"),M.event_queue.push(post_data),oa(M),void d(a);if("calldeviceadd"==c)var j="/v2/device/add";else var j="/v2/report/add";La(post_data),void 0==M.uuid||null==M.uuid?("user_attr_queue"in M||(M.user_attr_queue=[]),J&&console.log("Not sent queued!"),M.event_queue.push(post_data),oa(M),d(a)):(za({get:e,post:post_data,ts:parseInt(get_params.device_ts/1e3)}),Ia(I+j,e,post_data,function(b,c,e){b=""==b?{}:JSON.parse(b),200==c?J&&console.log("Event,",e,"  Tracked!"):("event_queue"in M||(M.event_queue=[]),J&&console.log("Not sent queued!"),M.event_queue.push(e),oa(M)),d(a)}))})}else J&&console.log("Event not tracked as device not added!"),e(a)})})},Pa=function(a,b,c){return da.p.then(function(){return new Promise(function(e,f){1==M.device_add||qa(a)&&""!=b&&"null"!=b&&"undefined"!=b?ua().then(function(){if("string"!=typeof a||""==typeof a)return void(J&&console.log("User attributes(key) needs to be string and (value) = string/int/float/boolean.\nThe type you gave for key is "+typeof a+" and for value is "+typeof b+'.\nHence user attribute "'+String(a)+'" wont be added'));null!=b&&""!==b&&void 0!=b||J&&console.log("Value provided for user attribute",a,"is:",b,". This is a debug message and will not be shown in production env"),c=void 0!==c?c:"",sa().then(function(f){date=new Date,d={};var g={};if("USER_ATTRIBUTE_UNIQUE_ID"===a&&M.user_attr&&null!=M.user_attr.USER_ATTRIBUTE_UNIQUE_ID&&(null==M.user_attr.OLD_UNIQUE_IDS&&(M.user_attr.OLD_UNIQUE_IDS=[]),M.user_attr.OLD_UNIQUE_IDS.push(M.user_attr.USER_ATTRIBUTE_UNIQUE_ID),d.USER_ID_MODIFIED_FROM=M.user_attr.USER_ATTRIBUTE_UNIQUE_ID,delete M.user_attr.USER_ATTRIBUTE_UNIQUE_ID),null!=b&&void 0!=b)if("function"==typeof b.getMonth){var h={};h[a]=Math.round(b.getTime()-6e4*b.getTimezoneOffset()),null==g.timestamp&&(g.timestamp=[]),g.timestamp.push(h)}else if(b instanceof r&&"MoeLocation"===b.type){var h={};h[a]=b.getLatLongString(),null==g.location&&(g.location=[]),g.location.push(h)}else d[a]=b;else d[a]=b;if(post_data={e:"EVENT_ACTION_USER_ATTRIBUTE",h:c},post_data.a=d,0===Object.keys(g).length&&g.constructor===Object||(post_data.c=g),a in M.user_attr&&M.user_attr[a]==b)return void e(a);M.user_attr[a]=b,oa(M,!0).then(function(){if(0==K)return"user_attr_queue"in M||(M.user_attr_queue=[]),J&&console.log("not sent queued!"),M.user_attr_queue.push(post_data),oa(M),void e(a)}),void 0==M.uuid||null==M.uuid?("user_attr_queue"in M||(M.user_attr_queue=[]),J&&console.log("Not sent queued!"),M.user_attr_queue.push(post_data),oa(M),e(a)):(za({get:f,post:post_data,ts:parseInt(get_params.device_ts/1e3)}),Ia(I+"/v2/report/add",f,post_data,function(b,c,d){b=""==b?{}:JSON.parse(b),200==c?J&&console.log("User Attribute, ",d,"  Tracked!"):("user_attr_queue"in M||(M.user_attr_queue=[]),J&&console.log("Not sent queued!"),M.user_attr_queue.push(d),oa(M)),e(a)}))})}):(J&&console.log("Event not tracked as device not added!.. Please note that, on a subscriber based billing, the user will be added %c ONLY on giving push permission or email."),f(a))})})},Qa=function(a,b){Ma("MOE_LOGOUT").then(function(){0!=moeHttpsFlag||webSdkIntegration?Ra():webio.sendMessage("destroy_session").then(function(){Ra()})})},Ra=function(){K=0,F.removeItem("moeWebSDKSettings"),F.removeItem("MOE_ACCEPTED"),F.removeItem("moeWebSDKSettingsSetupTime"),F.removeItem("moengage_data"),F.removeItem("moengage_data_subdomain"),F.removeItem("moe-ftl"),F.removeItem("ask_web_push"),F.removeItem("MOE_LAST_PROMPT"),F.removeItem("MOE_OPENED_ONCE"),F.removeItem("SOFT_LOAD"),F.removeItem("MOE_HTTP_OVERLAY"),M={user_attr:{},event_queue:[],user_attr_queue:[],
device_add:!1},oa(M),Da(!0)},Sa=function(a,b){return Na("USER_ATTRIBUTE_USER_FIRST_NAME",a,b)},Ta=function(a,b){return Na("USER_ATTRIBUTE_USER_LAST_NAME",a,b)},Ua=function(a,b){return Na("USER_ATTRIBUTE_USER_EMAIL",a,b)},Va=function(a,b){return Na("USER_ATTRIBUTE_USER_MOBILE",a,b)},Wa=function(a,b){return Na("USER_ATTRIBUTE_USER_NAME",a,b)},Xa=function(a,b){return Na("USER_ATTRIBUTE_USER_GENDER",a,b)},Ya=function(a,b){if(null!=a&&"function"==typeof a.getMonth){var c=a.getDate()+"/"+(a.getMonth()+1)+"/"+a.getFullYear();return Na("USER_ATTRIBUTE_USER_BDAY",c,b)}return Na("USER_ATTRIBUTE_USER_BDAY",a,b)},Za=function(a,b){return M.user_attr&&null!=M.user_attr.USER_ATTRIBUTE_UNIQUE_ID?M.user_attr.USER_ATTRIBUTE_UNIQUE_ID!=a?Ma("MOE_LOGOUT",{type:"forced"}).then(function(){return Ra(),new Promise(function(c,d){window.addEventListener("DEVICE_ADD_CALL_INTERNAL",function(d){d.detail&&d.detail.result&&"success"===d.detail.result&&Na("USER_ATTRIBUTE_UNIQUE_ID",a,b).then(function(){c()})})})}):void(J&&console.log("Same id was sent for the user. Not doing anything for this request.")):Na("USER_ATTRIBUTE_UNIQUE_ID",a,b)},$a=function(a,b){return Na("USER_ATTRIBUTE_UNIQUE_ID",a,b)},_a=function(a,b){return new r(a,b)};r.prototype.getLatLongString=function(){return this.lat+","+this.long};var ab=function(a){var b=window.RequestFileSystem||window.webkitRequestFileSystem;return new Promise(function(a){b?b(window.TEMPORARY,100,function(){a(!1)},function(){a(!0)}):a(!1)})};ab().then(function(a){U=a});var bb,cb=!0,db=2;moeIsOpenedOnce=function(a,b){webio.sendMessage("opened_once").then(function(a){cb="yes"==a.token,ta().then(function(a){B(a,ba),D(a)&&ha.p.then(function(a){if("prompt"==a){var c=new CustomEvent("MOE_OPT_IN",{detail:"opt_in_shown"});window.dispatchEvent(c),Ma("MOE_OPT_IN_SHOWN",{})}u(b)})})}),"banner"==a&&(ta().then(function(a){if(a.webData.call_push_moengage){var b=new CustomEvent("MOE_OPT_IN",{detail:"soft_ask_allowed"});window.dispatchEvent(b),Ma("MOE_WEB_OPTIN_ACCEPTED",{})}}),moeCloseBanner())},moeOpenPopup=function(){var a=Ja(Ba,bb);window.open(a,"mywin","width=150,height=150,resizable=0"),document.getElementById("moe_overlay")?(document.getElementById("moe_overlay").style.opacity="0",document.getElementById("moe_overlay").style.display="none",Ma("MOE_HTTP_OVERLAY_CLICKED",{REPEAT:ba})):J&&console.log("MOENGAGE_OVERLAY MISSING")},moeSubscribeUserSwap=function(a,b){function c(a,b){function c(){ta().then(function(a){V.then(function(){navigator.serviceWorker.ready.then(function(b){var c=!1,d="",e={userVisibleOnly:!0};return"Google Chrome"===G||"Opera"===G||"Opera Neon"===G?"vapid"===P(a,"webData.webPushPlatformData.chrome.subscriptionMode","normal")&&null!=P(a,"webData.webPushPlatformData.chrome.vapidPublicKey",null)&&(c=!0,e.applicationServerKey=N(a.webData.webPushPlatformData.chrome.vapidPublicKey),d=a.webData.webPushPlatformData.chrome.vapidPublicKey):"Mozilla Firefox"===G&&"vapid"===P(a,"webData.webPushPlatformData.firefox.subscriptionMode","normal")&&null!=P(a,"webData.webPushPlatformData.firefox.vapidPublicKey",null)&&(c=!0,e.applicationServerKey=N(a.webData.webPushPlatformData.firefox.vapidPublicKey),d=a.webData.webPushPlatformData.firefox.vapidPublicKey),b.pushManager.getSubscription().then(function(a){if(!a)return b.pushManager.subscribe(e);if(c&&a.options&&a.options.applicationServerKey){var f=O(a.options.applicationServerKey);return f!==d&&f!==d+"="&&f!==d+"=="?a.unsubscribe().then(function(){return b.pushManager.subscribe(e)}):a}return a}).catch(function(a){console.error("Error during getSubscription()",a)})}).then(function(a){var b=JSON.parse(JSON.stringify(a)),c=b.endpoint.split("/");if(c.pop(),b.endpoint=c.join("/")+"/",b.keys){for(var e in b.keys)b.keys.hasOwnProperty(e)&&(b["keys_"+e]=b.keys[e]);delete b.keys}F.setItem("MOE_PUSH_ENDPOINT",JSON.stringify(b)),F.setItem("ask_web_push",!1);var f=a.endpoint.split("/"),g=f[f.length-1];F.setItem("MOE_PUSH_TOKEN",g),fa.res(),F.setItem("MOE_ACCEPTED","ACCEPT"),moeDomainLevelStorageFlag&&k("MOE_PERMISSION_URL",window.location.origin),void 0==d||null==d?(ua().then(function(){Na("Web Push Preference","granted"),Na("Web Subscription URL",window.location.href),Ma("MOE_USER_SUBSCRIBED",{MOE_WEB_PUSH_TOKEN:g,URL:window.location.href},"calldeviceadd"),Ma("MOE_USER_SUBSCRIBED",{MOE_WEB_PUSH_TOKEN:g,URL:window.location.href})}),sa().then(function(a){a.push_id=g,navigator.serviceWorker.ready.then(function(b){navigator.serviceWorker.controller&&navigator.serviceWorker.controller.postMessage({data:a})})})):(d!=g||ia)&&(ua().then(function(){moeEvents.emitEvent("permission",["granted"]),Na("Web Push Preference","granted"),Ma("MOE_USER_SUBSCRIPTION_CHECK",{MOE_WEB_PUSH_TOKEN:g,URL:window.location.href},"calldeviceadd"),Ma("MOE_USER_SUBSCRIPTION_CHECK",{MOE_WEB_PUSH_TOKEN:g,URL:window.location.href})}),sa().then(function(a){a.push_id=g,navigator.serviceWorker.controller.postMessage({data:a})}))}).catch(function(a){console.log(a)})})})}sa().then(function(a){navigator.serviceWorker.ready.then(function(){var b=F.getItem("MOE_PUSH_TOKEN");b&&(a.push_id=b),navigator.serviceWorker.controller&&navigator.serviceWorker.controller.postMessage({data:a})})}),ta().then(function(f){Ea(f.webData,FEATURE_LIST.WEB_PUSH)&&(ha.p.then(function(a){"prompt"==a&&(ta().then(function(a){0==a.webData.banner.banner_flag&&moeLoadBannerInternal(!0)}),moeEvents.on("permission",function(a){hideOneClickTransparentOverlay()}))}),"granted"!=b?Notification.requestPermission(function(b){if(moeDomainLevelStorageFlag){k("MOE_PERMISSION","default"==b?"prompt":b)}"granted"==b?(moeEvents.emitEvent("permission",["granted"]),ha.p.then(function(b){if("prompt"==b){var c=new CustomEvent("MOE_OPT_IN",{detail:"opt_in_allowed"});window.dispatchEvent(c),Ma("MOE_OPT_IN_ALLOWED",{}),a&&a.hard_ask_allow_callback&&a.hard_ask_allow_callback()}}),c()):"default"==b?(ha.p.then(function(b){if("prompt"==b){var c=new CustomEvent("MOE_OPT_IN",{detail:"opt_in_dismissed"});window.dispatchEvent(c),Ma("MOE_OPT_IN_DISMISSED",{}),a&&a.hard_ask_dismiss_callback&&a.hard_ask_dismiss_callback()}}),F.setItem("MOE_PUSH_TOKEN","NA"),("PROMPT"!=e||ia)&&(moeEvents.emitEvent("permission",["prompt"]),Na("Web Push Preference","prompt")),F.setItem("MOE_LAST_PROMPT",Date.now()),moeEvents.emitEvent("permission",["clicked_close"]),F.setItem("MOE_ACCEPTED","PROMPT"),ra()||ca||(M.device_add=!1,oa(M,!0),X=null)):"denied"==b&&(ha.p.then(function(b){if("prompt"==b){var c=new CustomEvent("MOE_OPT_IN",{detail:"opt_in_blocked"});window.dispatchEvent(c),Ma("MOE_OPT_IN_BLOCKED",{}),Ma("Web Push Opt-in Denied",{}),a&&a.hard_ask_block_callback&&a.hard_ask_block_callback()}}),F.setItem("MOE_PUSH_TOKEN","NA"),("DENY"!=e||ia)&&(F.setItem("ask_web_push",!1),moeEvents.emitEvent("permission",["denied"]),Na("Web Push Preference","denied")),F.setItem("MOE_ACCEPTED","DENY"),ra()||ca||(M.device_add=!1,oa(M,!0),X=null))}):(moeEvents.emitEvent("permission",["granted"]),moeDomainLevelStorageFlag?window.location.origin!=l("MOE_PERMISSION_URL")&&void 0!=d&&null!=d||c():c()))})}var d=null,e=null;try{d=F.getItem("MOE_PUSH_TOKEN"),e=F.getItem("MOE_ACCEPTED")}catch(a){}"banner"==a&&(ta().then(function(a){if(a.webData.call_push_moengage){var b=new CustomEvent("MOE_OPT_IN",{detail:"soft_ask_allowed"});window.dispatchEvent(b),Ma("MOE_WEB_OPTIN_ACCEPTED",{})}}),moeCloseBanner()),ha.p.then(function(a){"prompt"==a?ta().then(function(a){if(D(a)){var d=new CustomEvent("MOE_OPT_IN",{detail:"opt_in_shown"});window.dispatchEvent(d),Ma("MOE_OPT_IN_SHOWN",{}),c(b)}}):c(b,a)})};var eb=function(){var a={soft_ask:!1,hard_ask:!1};arguments.length>0&&(arguments.length>1?J&&console.log("call_web_push expects zero/one arguments."):null!==arguments[0]&&"object"==typeof arguments[0]?(a.hard_ask=arguments[0].hard_ask||!1,a.soft_ask=arguments[0].soft_ask||!1,a.main_class=arguments[0].main_class||"",a.allow_class=arguments[0].allow_class||"",a.block_class=arguments[0].block_class||"",a.soft_ask_display_callback=arguments[0].soft_ask_display_callback||function(){},a.soft_ask_allow_callback=arguments[0].soft_ask_allow_callback||function(){},a.soft_ask_block_callback=arguments[0].soft_ask_block_callback||function(){},a.hard_ask_allow_callback=arguments[0].hard_ask_allow_callback||function(){},a.hard_ask_dismiss_callback=arguments[0].hard_ask_dismiss_callback||function(){},a.hard_ask_block_callback=arguments[0].hard_ask_block_callback||function(){},arguments[0].soft_ask_display_callback&&"function"!=typeof arguments[0].soft_ask_display_callback&&(a.soft_ask_display_callback=function(){},J&&console.log("soft_ask_display_callback should be a function")),arguments[0].soft_ask_allow_callback&&"function"!=typeof arguments[0].soft_ask_allow_callback&&(a.soft_ask_allow_callback=function(){},J&&console.log("soft_ask_allow_callback should be a function")),arguments[0].soft_ask_block_callback&&"function"!=typeof arguments[0].soft_ask_block_callback&&(a.soft_ask_block_callback=function(){},J&&console.log("soft_ask_block_callback should be a function")),arguments[0].hard_ask_allow_callback&&"function"!=typeof arguments[0].hard_ask_allow_callback&&(a.hard_ask_allow_callback=function(){},J&&console.log("hard_ask_allow_callback should be a function")),arguments[0].hard_ask_dismiss_callback&&"function"!=typeof arguments[0].hard_ask_dismiss_callback&&(a.hard_ask_dismiss_callback=function(){},J&&console.log("hard_ask_dismiss_callback should be a function")),arguments[0].hard_ask_block_callback&&"function"!=typeof arguments[0].hard_ask_block_callback&&(a.hard_ask_block_callback=function(){},J&&console.log("hard_ask_block_callback should be a function"))):J&&console.log("call_web_push expects an object as the argument.")),ha.p.then(function(){da.p.then(function(){"Google Chrome"!=G&&"Mozilla Firefox"!=G&&"Opera"!=G&&"Opera Neon"!=G||(J&&console.log("CALL WEB PUSH"),ta().then(function(b){ib(b,a)}))})})},fb={},gb=function(a,b,c){var d="banner";[].map.call(document.getElementsByClassName(a.main_class),function(a){a.style.display="block"}),Ma("MOE_WEB_OPTIN_BANNER_LOAD",{});var e=new CustomEvent("MOE_OPT_IN",{detail:"soft_ask_shown"});window.dispatchEvent(e),a&&a.soft_ask_display_callback&&a.soft_ask_display_callback(),[].map.call(document.getElementsByClassName(a.allow_class),function(e){e.addEventListener("click",function(){[].map.call(document.getElementsByClassName(a.main_class),function(a){a.style.display="none"});var e=new CustomEvent("MOE_OPT_IN",{detail:"soft_ask_allowed"});window.dispatchEvent(e),Ma("MOE_WEB_OPTIN_ACCEPTED",{}),a&&a.soft_ask_allow_callback&&a.soft_ask_allow_callback(),"https"==b.webData.domain_type?moeSubscribeUserSwap(d,a):b.webData.conventional&&1==b.webData.conventional?y():"http"==b.webData.domain_type&&1==c?(moeOpenPopup(),t()):"http"==b.webData.domain_type&&moeIsOpenedOnce(d,a)})}),[].map.call(document.getElementsByClassName(a.block_class),function(b){b.addEventListener("click",function(){[].map.call(document.getElementsByClassName(a.main_class),function(a){a.style.display="none"}),a&&a.soft_ask_block_callback&&a.soft_ask_block_callback();var b=new CustomEvent("MOE_OPT_IN",{detail:"soft_ask_closed"});window.dispatchEvent(b),Ma("MOE_WEB_OPTIN_CLOSED",{}),F.setItem("SOFT_LOAD",Date.now())})})},hb=function(a){fb=a,ta().then(function(b){"ACCEPT"!=F.getItem("MOE_ACCEPTED")&&"DENY"!=F.getItem("MOE_ACCEPTED")?D(b)&&gb(a,b):"ACCEPT"!=F.getItem("MOE_ACCEPTED")||"http"!=b.webData.domain_type||!a||1!=a.soft_ask||F.getItem("MOE_PUSH_TOKEN")&&"NA"!=F.getItem("MOE_PUSH_TOKEN")&&"null"!=F.getItem("MOE_PUSH_TOKEN")||D(b)&&gb(a,b,!0)})},ib=function(a,b){ab().then(function(c){U=c;var d=F.getItem("ask_web_push");if(U)J&&console.log("%cWEB Push - Not supported in Incognito-Mode","color: red; font-size:20px;");else if("https"==a.webData.domain_type){moeHttpsFlag=!0;var e=0;a.webData.load_time&&1==a.webData.call_push_moengage&&(e=1e3*a.webData.load_time),1==b.hard_ask?setTimeout(moeSubscribeUserSwap,0):0==a.webData.call_push_moengage?1==b.soft_ask?"granted"==W?setTimeout(moeSubscribeUserSwap,0):setTimeout(function(){hb(b)},0):a.webData.banner&&a.webData.banner.banner_flag?a.webData.banner&&a.webData.banner.banner_flag&&("granted"==W?setTimeout(moeSubscribeUserSwap,0):"false"!=d&&setTimeout(moeLoadBanner,0)):setTimeout(moeSubscribeUserSwap,0):a.webData.call_push_moengage&&a.webData.banner&&a.webData.banner.banner_flag?a.webData.call_push_moengage&&a.webData.banner&&a.webData.banner.banner_flag&&("granted"==W?setTimeout(moeSubscribeUserSwap,0):"false"!=d&&setTimeout(moeLoadBanner,e)):setTimeout(moeSubscribeUserSwap,e)}else"http"==a.webData.domain_type&&(moeHttpsFlag=!1,sa().then(function(c){bb=c,delete bb.os_platform,Ba=a.webData.subdomainUrl||"https://abc.moengage.com/";var d=0;a.webData.load_time&&1==a.webData.call_push_moengage&&(d=1e3*a.webData.load_time),1==b.hard_ask?setTimeout(moeIsOpenedOnce,0):0==a.webData.call_push_moengage?1==b.soft_ask?setTimeout(function(){hb(b)},0):a.webData.banner&&a.webData.banner.banner_flag?a.webData.banner&&a.webData.banner.banner_flag&&setTimeout(moeLoadBanner,0):setTimeout(moeIsOpenedOnce,0):a.webData.call_push_moengage&&a.webData.banner&&a.webData.banner.banner_flag?a.webData.call_push_moengage&&a.webData.banner&&a.webData.banner.banner_flag&&setTimeout(moeLoadBanner,d):setTimeout(moeIsOpenedOnce,d)}))})},jb=function(){return da.p.then(function(){return ta().then(function(a){return{userStructure:M,sdkSettings:a.webData}})})};return function(a){if(window.moe_data_internal=a,Ga())return{track_event:Ma,add_user_attribute:Na,add_first_name:Sa,add_last_name:Ta,add_email:Ua,add_mobile:Va,add_user_name:Wa,add_gender:Xa,add_birthday:Ya,destroy_session:Qa,add_unique_user_id:Za,update_unique_user_id:$a,moe_events:moeEvents,call_web_push:eb,location_type_attribute:_a,test_cases:jb}}}();