var RMS=function(){function e(e){for(var t=[],r=0;r<e.length;r++)t.push(e[r].join("_"));return t.join("-")}function t(e,t){if(e&&t)for(var r=0,n=e.length;n>r;r++)if(e[r]==t)return r;return-1}function r(e){var t,r=new Array;return r[0]=e>>>24>>>0,r[1]=e<<8>>>24>>>0,r[2]=e<<16>>>24,r[3]=e<<24>>>24,t=String(r[0])+"."+String(r[1])+"."+String(r[2])+"."+String(r[3])}var n,o,i=[[0,0,0]],c=[[0,0,0],[0,0,0]],a=location.protocol+"//cdid.c-ctrip.com/model-poc2/h",d=location.protocol.replace("http","ws")+"//cdid.c-ctrip.com/model-poc2/w",s=!1,u=location.protocol+"//"+location.host,y=function(e,r){if(!r&&e)try{for(var n=e.split("|"),o=[],c=1,a=n.length;a>c;c++)if(n[c].indexOf("__kc__")>0){var d=n[c].split(","),s=d[1].substr(8);t(o,s)<0&&o.push(s),d.length>=3&&(i.push([d[0],d[1].substr(6,1)+t(o,s),d[2]]),i.length>20&&i.splice(1,1))}}catch(u){}},p=function(e){try{e.ctrlKey&&67==e.keyCode&&(i[0][0]=1),e.ctrlKey&&86==e.keyCode&&(i[0][1]=1),e.ctrlKey&&88==e.keyCode&&(i[0][2]=1);var t=parseInt((e.altKey?"1":"0")+(e.shiftKey?"1":"0")+(e.ctrlKey?"1":"0")+(8==e.keyCode?"1":"0"),2).toString(16);return"__kc__"+t+"_"+e.keyCode}catch(e){return"error!"}},_=function(e){try{e.ctrlKey&&67==e.keyCode&&(c[0][0]=1),e.ctrlKey&&86==e.keyCode&&(c[0][1]=1),e.ctrlKey&&88==e.keyCode&&(c[0][2]=1);var t=parseInt((e.altKey?"1":"0")+(e.shiftKey?"1":"0")+(e.ctrlKey?"1":"0")+(8==e.keyCode?"1":"0"),2).toString(16);return"__kc2__"+t+"_"+e.keyCode}catch(e){return"error!"}},f=function(e){try{e.ctrlKey&&67==e.keyCode&&(c[1][0]=1),e.ctrlKey&&86==e.keyCode&&(c[1][1]=1),e.ctrlKey&&88==e.keyCode&&(c[1][2]=1);var t=parseInt((e.altKey?"1":"0")+(e.shiftKey?"1":"0")+(e.ctrlKey?"1":"0")+(8==e.keyCode?"1":"0"),2).toString(16);return"__kc3__"+t+"_"+e.keyCode}catch(e){return"error!"}},l=[[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0]],h=0,w=0,k=0,g=0,m=0,v=0,K=0,b=0,C=0,x=0,R=0,I=0,S=0,M=0,D=0,T=0,L=0,E=0,q=function(e){try{var t=!1;e.ctrlKey&&67==e.keyCode&&(l[1][0]=1,t=!0),e.ctrlKey&&86==e.keyCode&&(l[1][1]=1,t=!0),e.ctrlKey&&88==e.keyCode&&(l[1][2]=1,t=!0),8==e.keyCode&&"keydown"==e.type&&(l[1][3]=++h,t=!0),0==T&&(T=1*new Date),l[1][4]=1*new Date-T,e.altKey&&"keydown"==e.type&&(l[1][6]=1,t=!0),e.shiftKey&&"keydown"==e.type&&(l[1][7]=++g,t=!0),e.shiftKey&&e.ctrlKey&&"keydown"==e.type&&(l[1][8]=++K,t=!0),e.ctrlKey&&32==e.keyCode&&(l[1][9]=++x,t=!0),t?l[1][5]=++S:"keydown"==e.type&&(l[1][5]=++S);var r=parseInt((e.altKey?"1":"0")+(e.shiftKey?"1":"0")+(e.ctrlKey?"1":"0")+(8==e.keyCode?"1":"0"),2).toString(16);return"__kbCm__"+r+"_"+e.keyCode}catch(e){return"error!"}},z=function(e){try{var t=!1;e.ctrlKey&&67==e.keyCode&&(l[0][0]=1,t=!0),e.ctrlKey&&86==e.keyCode&&(l[0][1]=1,t=!0),e.ctrlKey&&88==e.keyCode&&(l[0][2]=1,t=!0),8==e.keyCode&&"keydown"==e.type&&(l[0][3]=++w,t=!0),0==L&&(L=1*new Date),l[0][4]=1*new Date-L,e.altKey&&"keydown"==e.type&&(l[0][6]=1,t=!0),e.shiftKey&&"keydown"==e.type&&(l[0][7]=++m,t=!0),e.shiftKey&&e.ctrlKey&&"keydown"==e.type&&(l[0][8]=++b,t=!0),e.ctrlKey&&32==e.keyCode&&(l[0][9]=++R,t=!0),t?l[0][5]=++M:"keydown"==e.type&&(l[0][5]=++M);var r=parseInt((e.altKey?"1":"0")+(e.shiftKey?"1":"0")+(e.ctrlKey?"1":"0")+(8==e.keyCode?"1":"0"),2).toString(16);return"__kbMb__"+r+"_"+e.keyCode}catch(e){return"error!"}},H=function(e){try{var t=!1;e.ctrlKey&&67==e.keyCode&&(l[2][0]=1,t=!0),e.ctrlKey&&86==e.keyCode&&(l[2][1]=1,t=!0),e.ctrlKey&&88==e.keyCode&&(l[2][2]=1,t=!0),8==e.keyCode&&"keydown"==e.type&&(l[2][3]=++k,t=!0),0==E&&(E=1*new Date),l[2][4]=1*new Date-E,e.altKey&&"keydown"==e.type&&(l[2][6]=1,t=!0),e.shiftKey&&"keydown"==e.type&&(l[2][7]=++v,t=!0),e.shiftKey&&e.ctrlKey&&"keydown"==e.type&&(l[2][8]=++C,t=!0),e.ctrlKey&&32==e.keyCode&&(l[2][9]=++I,t=!0),t?l[2][5]=++D:"keydown"==e.type&&(l[2][5]=++D);var r=parseInt((e.altKey?"1":"0")+(e.shiftKey?"1":"0")+(e.ctrlKey?"1":"0")+(8==e.keyCode?"1":"0"),2).toString(16);return"__kbPcno__"+r+"_"+e.keyCode}catch(e){return"error!"}},O=function(){},A=function(e,t){return Math.floor(Math.random()*(t-e+1))+e},P=function(){function e(e){this.init(e)}var t=window,r=function(){var e;return t.XMLHttpRequest&&"withCredentials"in new t.XMLHttpRequest?e=t.XMLHttpRequest:t.XDomainRequest&&(e=t.XDomainRequest),e}(),n=["head","get","post","put","delete"],o={};e.prototype.init=function(e){var t=this;t.xhr=new r,t.method=e.method,t.url=e.url,t.success=e.success,t.error=e.error;try{t.xhr.timeout=2e3,t.xhr.ontimeout=function(){},e.credentials===!0&&(t.xhr.withCredentials=!0)}catch(n){}var o=e.params?e.params:e.data;return t.headers=e.headers,t.send(o),t},e.prototype.send=function(e){var t=this;return void 0!==t.success&&(t.xhr.onload=function(){t.success.call(this,this.responseText)}),void 0!==t.error&&(t.xhr.error=function(){t.error.call(this,this.responseText)}),t.xhr.open(t.method,t.url,!0),void 0!==t.headers&&t.setHeaders(),e?t.xhr.send(e):t.xhr.send(),t},e.prototype.setHeaders=function(){var e,t=this,r=t.headers;try{for(e in r)r.hasOwnProperty(e)&&t.xhr.setRequestHeader(e,r[e])}catch(n){}return t};for(var i=0;i<n.length;i++)!function(){var t=n[i];o[t]=function(r,n){var o={};if(void 0===r)throw new Error("CORS: url must be defined");return"object"==typeof r?o=r:("function"==typeof n&&(o.success=n),o.url=r),o.method=t.toUpperCase(),new e(o).xhr}}();return o}(),j=function(){return!("XMLHttpRequest"in window&&"withCredentials"in new XMLHttpRequest)},N=function(e,t,r){var n=document.createElement("input");return n.type="hidden",n.name=t,n.value=r,n.id=t+"_d__",e.appendChild(n),n},U=function(e,t,r){if(s)return setTimeout(function(){U(e,t,r)},30);if(s=!0,j()){if(createIframe(),n.action=e,o.name=t,o.value=r,guid){var i=document.getElementById("guid_d__");i?i.value=guid:N(n,"guid",guid)}n.submit()}else{var c=t+"="+r+"&serverName="+u;P.post({url:e,credentials:!0,params:c,method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},success:function(e){s=!1,e&&O(e)},error:function(){O("cors error"),s=!1}})}},X=!1;return{init:function(e){if(!X){X=!0,e=e?e:{};var t=(new Date,this);if(window.__bfi=window.__bfi||[],window.__bfi.push(["_getFP",function(e){t.fp=e},!1]),window.__bfi.push(["_getStatus",function(e){t.vid=e.vid},!1]),window.__bfi.push(["_getPageid",function(r,n){!r&&n&&(e.pageId||(e.pageId=n+"")),t.pageId=n}]),window.__bfi.push(["_trackKeyboard","txtContactMobilePhone",y,p]),window.__bfi.push(["_trackKeyboard","J_mobile",y,p]),window.__bfi.push(["_trackKeyboard","J_resident_1",function(){},_]),window.__bfi.push(["_trackKeyboard","J_resident_2",function(){},f]),window.__bfi.push(["_trackKeyboard","J_mobile",function(){},z]),window.__bfi.push(["_trackKeyboard","p_card_no_0",function(){},H]),window.__bfi.push(["_trackKeyboard","card_number_1",function(){},H]),window.__bfi.push(["_trackKeyboard","card_number_2",function(){},H]),window.__bfi.push(["_trackKeyboard","card_number_3",function(){},H]),window.__bfi.push(["_trackKeyboard","card_number_4",function(){},H]),window.__bfi.push(["_trackKeyboard","card_number",function(){},H]),window.__bfi.push(["_trackKeyboard","txtContactEmail",function(){},q]),window.__bfi.push(["_trackKeyboard","pickupEmail",function(){},q]),window.__bfi.push(["_trackKeyboard","I_contact_mail",function(){},q]),window.__bfi.push(["_trackKeyboard","txtContactEMail",function(){},q]),window&&window.location){var r=!0,n=/^https?:\/\/((ct\.ctrip\.com)|([0-9a-zA-Z\.]*ctripcorp\.))/,o=n.exec(window.location);r=!o,r||(n=/^https?:\/\/(([0-9a-zA-Z\.]*qa\.nt\.ctripcorp\.))/,o=n.exec(window.location),r=o),r&&!function(){var e="//webresource.c-ctrip.com/resaresonline/risk/ubtrms/d.min.dc6267c1.js",t=10;setTimeout(function(){var t=document.createElement("script");t.type="text/javascript",t.id="rmsd__script",t.async=!0,t.src=("https:"==document.location.protocol?"https:":"http:")+e;var r=document.getElementsByTagName("script")[0];r.parentNode.insertBefore(t,r)},t),window.rmsd__startScriptLoad=1*new Date}()}var i=function(){var e=window.__rmsbfi||[],t=e.push=function(){for(var e=arguments,t=0,r=e.length,n=0;r>n;n++)try{if("function"==typeof e[n])e[n]();else if("[object Array]"===Object.prototype.toString.call(e[n])){if(2!=e[n].length)continue;var o=e[n][0],i=e[n][1];"string"==typeof o&&"_getRmsToken"===o&&"function"==typeof i&&i(RMS.getRmsToken())}}catch(c){t++}return t};for(window.__rmsbfi=e;e.length>0;)t(e.shift())};i()}},getRmsToken:function(){var t="fp="+(this.fp?this.fp:"");t+="&vid="+(this.vid?this.vid:""),t+="&pageId="+(this.pageId?this.pageId:"");var n=/\_RGUID=([a-z0-9\-]+)(;|$)/.exec(document.cookie),o=/guid\_\_=([a-z0-9\-]+)(;|$)/.exec(document.cookie);if(n&&n.length>1){var a=n[1].replace(/\-/g,"");t+="&r="+a}else if(o&&o.length>1){var a=o[1].replace(/\-/g,"");t+="&r="+a}else t+="&r="+window.CHLOROFP_STATUS;var d=window.CHLOROFP_IP;if(!d){var s=/\_RF1=([0-9\.]+)(;|$)/.exec(document.cookie);s&&s.length>1&&(d=s[1])}isNaN(Number(d))||(d=r(Number(d))),d&&(d=d.replace(/^\s+|\s+$/g,"")),t+="&ip="+d,t+="&kpData="+e(i),t+="&kpControl="+e(c),t+="&kpEmp="+e(l),t+="&screen="+screen.width+"x"+screen.height;var u=(new Date).getTimezoneOffset()/60;t+="&tz="+(0>u?"+":"-")+Math.abs(u),t+="&blang="+navigator.language||navigator.userLanguage,t+="&oslang="+navigator.language||navigator.systemLanguage,t+="&ua="+encodeURIComponent(navigator.userAgent);var y=/^https?:\/\/([a-zA-Z0-9.\-_]+)\/?/,p=y.exec(window.location);if(p&&p.length>1){var _=p[1];t+="&d="+encodeURIComponent(_)}return t+="&v=22",this.uuid&&(t+="&rmsId="+this.uuid),t},ping:function(e){if(window&&window.location&&"WebSocket"in window){var t=!0,r=/^https?:\/\/((ct\.ctrip\.com)|([0-9a-zA-Z\.]*ctripcorp\.))/,n=r.exec(window.location);if(t=!n){if(!e){var o=/\_RGUID=([a-z0-9\-]+)(;|$)/.exec(document.cookie),i=/guid\_\_=([a-z0-9\-]+)(;|$)/.exec(document.cookie);o&&o.length>1?e=o[1].replace(/\-/g,""):i&&i.length>1&&(e=i[1].replace(/\-/g,""))}if(e){e=e+"_"+A(1,100),O(e);var c=new WebSocket(d);c.addEventListener("open",function(){c.send(e)}),c.addEventListener("message",function(t){var r=t.data;O("websocket: ",r),"OK"===r?c.close():c.send(r+":"+e)}),U(a,"requestId",e)}}}}}}();RMS.init(),RMS.ping();
//# sourceMappingURL=rms.js.386b39d3.map